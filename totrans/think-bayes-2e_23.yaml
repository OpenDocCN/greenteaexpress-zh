- en: Approximate Bayesian Computation
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 近似贝叶斯计算
- en: 原文：[https://allendowney.github.io/ThinkBayes2/chap20.html](https://allendowney.github.io/ThinkBayes2/chap20.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '[https://allendowney.github.io/ThinkBayes2/chap20.html](https://allendowney.github.io/ThinkBayes2/chap20.html)'
- en: This chapter introduces a method of last resort for the most complex problems,
    Approximate Bayesian Computation (ABC). I say it is a last resort because it usually
    requires more computation than other methods, so if you can solve a problem any
    other way, you should. However, for the examples in this chapter, ABC is not just
    easy to implement; it is also efficient.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍了一种应对最复杂问题的最后手段，即近似贝叶斯计算（ABC）。我说这是最后的手段，因为它通常需要比其他方法更多的计算，所以如果您可以以其他方式解决问题，那就应该这样做。然而，在本章的例子中，ABC不仅易于实现，而且高效。
- en: The first example is my solution to a problem posed by a patient with a kidney
    tumor. I use data from a medical journal to model tumor growth, and use simulations
    to estimate the age of a tumor based on its size.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个例子是我对一个患有肾脏肿瘤的患者提出的问题的解决方案。我使用了医学期刊上的数据来模拟肿瘤生长，并使用模拟来估计肿瘤的年龄。
- en: The second example is a model of cell counting, which has applications in biology,
    medicine, and zymurgy (beer-making). Given a cell count from a diluted sample,
    we estimate the concentration of cells.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个例子是细胞计数模型，它在生物学、医学和酿酒学（啤酒制造）中都有应用。给定稀释样本的细胞计数，我们估计细胞的浓度。
- en: Finally, as an exercise, you’ll have a chance to work on a fun sock-counting
    problem.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，作为一项练习，您将有机会解决一个有趣的袜子计数问题。
- en: The Kidney Tumor Problem
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 肾脏肿瘤问题
- en: 'I am a frequent reader and occasional contributor to the online statistics
    forum at [http://reddit.com/r/statistics](http://reddit.com/r/statistics). In
    November 2011, I read the following message:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 我经常阅读并偶尔在[http://reddit.com/r/statistics](http://reddit.com/r/statistics)的在线统计论坛上发表贴子。2011年11月，我读到了以下消息：
- en: “I have Stage IV Kidney Cancer and am trying to determine if the cancer formed
    before I retired from the military. … Given the dates of retirement and detection
    is it possible to determine when there was a 50/50 chance that I developed the
    disease? Is it possible to determine the probability on the retirement date? My
    tumor was 15.5 cm x 15 cm at detection. Grade II.”
  id: totrans-8
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “我患有第四期肾癌，正在尝试确定癌症是否在我从军队退休之前形成。…鉴于退伍和发现的日期，是否可能确定我患病的概率为50/50？是否可能确定退伍日期上的概率？我的肿瘤在检测时为15.5厘米x15厘米。II级。”
- en: I contacted the author of the message to get more information; I learned that
    veterans get different benefits if it is “more likely than not” that a tumor formed
    while they were in military service (among other considerations). So I agree to
    help him answer his question.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 我联系了留言的作者以获取更多信息；我了解到，如果有“更可能是”的证据表明肿瘤是在他们服役期间形成的（还有其他考虑因素），退伍军人将获得不同的福利。因此，我同意帮助他回答他的问题。
- en: Because renal tumors grow slowly, and often do not cause symptoms, they are
    sometimes left untreated. As a result, doctors can observe the rate of growth
    for untreated tumors by comparing scans from the same patient at different times.
    Several papers have reported these growth rates.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 由于肾脏肿瘤生长缓慢，通常不会引起症状，因此有时会不加治疗。因此，医生可以通过比较同一患者在不同时间的扫描来观察未经治疗的肿瘤的生长速率。有几篇论文报道了这些生长速率。
- en: 'For my analysis I used data from a paper by [Zhang et al](https://pubs.rsna.org/doi/full/10.1148/radiol.2501071712).
    They report growth rates in two forms:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我的分析，我使用了[Zhang et al](https://pubs.rsna.org/doi/full/10.1148/radiol.2501071712)的一篇论文中的数据。他们以两种形式报告生长速率：
- en: Volumetric doubling time, which is the time it would take for a tumor to double
    in size.
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 体积倍增时间，即肿瘤倍增的时间。
- en: Reciprocal doubling time (RDT), which is the number of doublings per year.
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 倒数倍增时间（RDT），即每年的倍增次数。
- en: The next section shows how we work with these growth rates.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 下一节将展示我们如何处理这些生长速率。
- en: Zhang et al, Distribution of Renal Tumor Growth Rates Determined by Using Serial
    Volumetric CT Measurements, January 2009 *Radiology*, 250, 137-144.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: Zhang et al, 通过使用连续体积CT测量确定的肾脏肿瘤生长速率分布，2009年1月《放射学》，250，137-144。
- en: '[https://pubs.rsna.org/doi/full/10.1148/radiol.2501071712](https://pubs.rsna.org/doi/full/10.1148/radiol.2501071712)'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://pubs.rsna.org/doi/full/10.1148/radiol.2501071712](https://pubs.rsna.org/doi/full/10.1148/radiol.2501071712)'
- en: A Simple Growth Model
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 一个简单的生长模型
- en: 'We’ll start with a simple model of tumor growth based on two assumptions:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从基于两个假设的肿瘤生长的简单模型开始：
- en: Tumors grow with a constant doubling time, and
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 肿瘤以恒定的倍增时间生长
- en: They are roughly spherical in shape.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它们大致呈球形。
- en: 'And I’ll define two points in time:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 我将定义两个时间点：
- en: '`t1` is when my correspondent retired.'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`t1`是我的通讯者退休时。'
- en: '`t2` is when the tumor was detected.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`t2`是肿瘤被检测到的时间。'
- en: The time between `t1` and `t2` was about 9.0 years. As an example, let’s assume
    that the diameter of the tumor was 1 cm at `t1`, and estimate its size at `t2`.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '`t1`和`t2`之间的时间约为9.0年。例如，假设肿瘤在`t1`时的直径为1厘米，我们可以估计它在`t2`时的大小。'
- en: I’ll use the following function to compute the volume of a sphere with a given
    diameter.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 我将使用以下函数来计算具有给定直径的球体的体积。
- en: '[PRE0]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Assuming that the tumor is spherical, we can compute its volume at `t1`.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 假设肿瘤是球形的，我们可以计算它在`t1`时的体积。
- en: '[PRE1]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '[PRE2]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The median volume doubling time reported by Zhang et al. is 811 days, which
    corresponds to an RDT of 0.45 doublings per year.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: Zhang et al.报告的中位体积倍增时间为811天，对应于每年0.45倍增。
- en: '[PRE3]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '[PRE4]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'We can compute the number of doublings that would have happened in the interval
    between `t1` and `t2`:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以计算在`t1`和`t2`之间的时间间隔内会发生的倍增次数：
- en: '[PRE5]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '[PRE6]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Given `v1` and the number of doublings, we can compute the volume at `t2`.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 给定`v1`和倍增次数，我们可以计算`t2`时的体积。
- en: '[PRE7]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '[PRE8]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The following function computes the diameter of a sphere with the given volume.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 以下函数计算具有给定体积的球体的直径。
- en: '[PRE9]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'So we can compute the diameter of the tumor at `t2`:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们可以计算在`t2`时肿瘤的直径：
- en: '[PRE10]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '[PRE11]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: If the diameter of the tumor was 1 cm at `t1`, and it grew at the median rate,
    the diameter would be about 2.5 cm at `t2`.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如果肿瘤在`t1`时的直径为1厘米，并且以中位数速率生长，那么在`t2`时，直径将约为2.5厘米。
- en: This example demonstrates the growth model, but it doesn’t answer the question
    my correspondent posed.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 这个例子演示了生长模型，但它并没有回答我对方提出的问题。
- en: A More General Model
  id: totrans-46
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更一般的模型
- en: Given the size of a tumor at time of diagnosis, we would like to know the distribution
    of its age. To find it, we’ll run simulations of tumor growth to get the distribution
    of size conditioned on age. Then we’ll compute the distribution of age conditioned
    on size.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 给定诊断时肿瘤的大小，我们想知道其年龄分布。为了找到它，我们将运行肿瘤生长的模拟，以获得在年龄条件下大小的分布。然后我们将计算在大小条件下的年龄分布。
- en: 'The simulation starts with a small tumor and runs these steps:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 模拟从一个小肿瘤开始，并运行以下步骤：
- en: Choose a value from the distribution of growth rates.
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从增长率的分布中选择一个值。
- en: Compute the size of the tumor at the end of an interval.
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算间隔结束时肿瘤的大小。
- en: Repeat until the tumor exceeds the maximum relevant size.
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重复直到肿瘤超过最大相关大小。
- en: So the first thing we need is the distribution of growth rates.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们需要的第一件事是增长率的分布。
- en: Using the figures in the paper by Zhange et al., I created an array, `rdt_sample`,
    that contains estimated values of RDT for the 53 patients in the study.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 使用张等人的论文中的数据，我创建了一个名为`rdt_sample`的数组，其中包含了该研究中53名患者的RDT的估计值。
- en: Again, RDT stands for “reciprocal doubling time”, which is in doublings per
    year. So if `rdt=1`, a tumor would double in volume in one year. If `rdt=2`, it
    would double twice; that is, the volume would quadruple. And if `rdt=-1`, it would
    halve in volume.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，RDT代表“倒数加倍时间”，即每年的加倍次数。因此，如果`rdt=1`，肿瘤在一年内体积加倍。如果`rdt=2`，它会加倍两次；也就是说，体积会增加四倍。如果`rdt=-1`，它会减半。
- en: <details class="hide above-input"><summary aria-label="Toggle hidden content">Show
    code cell content Hide code cell content</summary>
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: <details class="hide above-input"><summary aria-label="Toggle hidden content">显示代码单元格内容
    隐藏代码单元格内容</summary>
- en: '[PRE12]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '[PRE13]</details>'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE13]</details>'
- en: We can use the sample of RDTs to estimate the PDF of the distribution.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用RDT的样本来估计分布的概率密度函数。
- en: '[PRE14]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Here’s what it looks like.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 这是它的样子。
- en: <details class="hide above-input"><summary aria-label="Toggle hidden content">Show
    code cell source Hide code cell source</summary>
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: <details class="hide above-input"><summary aria-label="Toggle hidden content">显示代码单元格源代码
    隐藏代码单元格源代码</summary>
- en: '[PRE15]</details> ![_images/914a6146b4348099a8272fb971569ca6c637ea221de92d28038e20285408c1bd.png](../Images/fb5159fd84b272719c97dc5be1704503.png)'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE15]</details> ![_images/914a6146b4348099a8272fb971569ca6c637ea221de92d28038e20285408c1bd.png](../Images/fb5159fd84b272719c97dc5be1704503.png)'
- en: In the next section we will use this distribution to simulate tumor growth.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将使用这个分布来模拟肿瘤的生长。
- en: Simulation
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 模拟
- en: Now we’re ready to run the simulations. Starting with a small tumor, we’ll simulate
    a series of intervals until the tumor reaches a maximum size.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们准备好运行模拟了。从一个小肿瘤开始，我们将模拟一系列间隔，直到肿瘤达到最大大小。
- en: At the beginning of each simulated interval, we’ll choose a value from the distribution
    of growth rates and compute the size of the tumor at the end.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在每个模拟间隔的开始时，我们将从增长率的分布中选择一个值，并计算最终肿瘤的大小。
- en: I chose an interval of 245 days (about 8 months) because that is the median
    time between measurements in the data source
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 我选择了245天（约8个月）的间隔，因为这是数据来源中测量之间的中位时间
- en: For the initial diameter I chose 0.3 cm, because carcinomas smaller than that
    are less likely to be invasive and less likely to have the blood supply needed
    for rapid growth (see [this page on carcinoma](http://en.wikipedia.org/wiki/Carcinoma_in_situ)).
    For the maximum diameter I chose 20 cm.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 对于初始直径，我选择了0.3厘米，因为小于这个值的癌症更不可能侵袭，也不太可能有快速生长所需的血液供应（参见[癌症原位](http://en.wikipedia.org/wiki/Carcinoma_in_situ)）。对于最大直径，我选择了20厘米。
- en: '[PRE16]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'I’ll use `calc_volume` to compute the initial and maximum volumes:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 我将使用`calc_volume`来计算初始体积和最大体积：
- en: '[PRE17]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '[PRE18]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: The following function runs the simulation.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 以下函数运行模拟。
- en: '[PRE19]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '`simulate_growth` takes as a parameter a `Pmf` that represents the distribution
    of RDT. It initializes the age and volume of the tumor, then runs a loop that
    simulates one interval at a time.'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '`simulate_growth`以一个代表RDT分布的`Pmf`作为参数。它初始化肿瘤的年龄和体积，然后运行一个循环，逐个模拟间隔。 '
- en: Each time through the loop, it checks the volume of the tumor and exits if it
    exceeds `vmax`.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 每次循环时，它都会检查肿瘤的体积，并在超过`vmax`时退出。
- en: Otherwise it chooses a value from `pmf_rdt` and updates `age` and `volume`.
    Since `rdt` is in doublings per year, we multiply by `interval` to compute the
    number of doublings during each interval.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 否则，它会从`pmf_rdt`中选择一个值，并更新`age`和`volume`。由于`rdt`是每年的加倍次数，我们将其乘以`interval`来计算每个间隔期间的加倍次数。
- en: At the end of the loop, `simulate_growth` puts the results in a `DataFrame`
    and computes the diameter that corresponds to each volume.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在循环结束时，`simulate_growth`将结果放入一个`DataFrame`中，并计算与每个体积相对应的直径。
- en: 'Here’s how we call this function:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们调用这个函数的方式：
- en: '[PRE20]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Here are the results for the first few intervals:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是前几个间隔的结果：
- en: '[PRE21]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '|  | age | volume | diameter |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
  zh: '|  | 年龄 | 体积 | 直径 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-84
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| 0 | 0.000000 | 0.014137 | 0.300000 |'
  id: totrans-85
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 0.000000 | 0.014137 | 0.300000 |'
- en: '| 1 | 0.671233 | 0.014949 | 0.305635 |'
  id: totrans-86
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 0.671233 | 0.014949 | 0.305635 |'
- en: '| 2 | 1.342466 | 0.019763 | 0.335441 |'
  id: totrans-87
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 1.342466 | 0.019763 | 0.335441 |'
- en: And the last few intervals.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 最后几个间隔。
- en: '[PRE22]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '|  | age | volume | diameter |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
  zh: '|  | 年龄 | 体积 | 直径 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| 43 | 28.863014 | 1882.067427 | 15.318357 |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
  zh: '| 43 | 28.863014 | 1882.067427 | 15.318357 |'
- en: '| 44 | 29.534247 | 2887.563277 | 17.667603 |'
  id: totrans-93
  prefs: []
  type: TYPE_TB
  zh: '| 44 | 29.534247 | 2887.563277 | 17.667603 |'
- en: '| 45 | 30.205479 | 4953.618273 | 21.149883 |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
  zh: '| 45 | 30.205479 | 4953.618273 | 21.149883 |'
- en: 'To show the results graphically, I’ll run 101 simulations:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 为了以图形方式显示结果，我将运行101次模拟：
- en: '[PRE23]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: And plot the results.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 并绘制结果。
- en: <details class="hide above-input"><summary aria-label="Toggle hidden content">Show
    code cell source Hide code cell source</summary>
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: <details class="hide above-input"><summary aria-label="Toggle hidden content">显示代码单元格源代码
    隐藏代码单元格源代码</summary>
- en: '[PRE24]</details> ![_images/c7a36f14efef9fb97b73fc9d6d8d623e3d53b61e750e4ca983a63eb4eb7a227c.png](../Images/b9b0da08e32d428b971901dfd3f3e9e3.png)'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE24]</details> ![_images/c7a36f14efef9fb97b73fc9d6d8d623e3d53b61e750e4ca983a63eb4eb7a227c.png](../Images/b9b0da08e32d428b971901dfd3f3e9e3.png)'
- en: In this figure, each thin, solid line shows the simulated growth of a tumor
    over time, with diameter on a log scale. The dotted lines are at 4, 8, and 16
    cm.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个图中，每条细线显示了肿瘤随时间的模拟生长，直径采用对数刻度。虚线分别是4、8和16厘米。
- en: By reading across the dotted lines, you can get a sense of the distribution
    of age at each size. For example, reading across the top line, we see that the
    age of a 16 cm tumor might be as low 10 years or as high as 40 years, but it is
    most likely to be between 15 and 30.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 通过在虚线上横向阅读，您可以了解每个尺寸的年龄分布。例如，横向阅读顶部线，我们可以看到直径为16厘米的肿瘤的年龄可能低至10年或高至40年，但最可能在15到30年之间。
- en: To compute this distribution more precisely, we can interpolate the growth curves
    to see when each one passes through a given size. The following function takes
    the results of the simulations and returns the age when each tumor reached a given
    diameter.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更精确地计算这个分布，我们可以插值生长曲线，看看每个生长曲线何时通过给定的大小。以下函数接受模拟结果，并返回每个肿瘤达到给定直径时的年龄。
- en: '[PRE25]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'We can call this function like this:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以这样调用这个函数：
- en: '[PRE26]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '[PRE27]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: For a tumor 15 cm in diameter, the median age is about 22 years, the 90% credible
    interval is between 13 and 34 years, and the probability that it formed less than
    9 years ago is less than 1%.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 对于一个直径为15厘米的肿瘤，中位年龄约为22年，90%的可信区间在13到34年之间，形成于9年之前的概率小于1%。
- en: '[PRE28]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '[PRE29]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'But this result is based on two modeling decisions that are potentially problematic:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 但这个结果基于两个可能有问题的建模决策：
- en: In the simulations, growth rate during each interval is independent of previous
    growth rates. In reality it is plausible that tumors that have grown quickly in
    the past are likely to grow quickly in the future. In other words, there is probably
    a serial correlation in growth rate.
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在模拟中，每个间隔的生长速率独立于先前的生长速率。实际上，快速生长的肿瘤过去可能会快速生长。换句话说，生长速率可能存在串行相关性。
- en: To convert from linear measure to volume, we assume that tumors are approximately
    spherical.
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为了从线性测量转换为体积，我们假设肿瘤大致是球形的。
- en: In additional experiments, I implemented a simulation that chooses growth rates
    with serial correlation; the effect is that the fast-growing tumors grow faster
    and the slow-growing tumors grow slower. Nevertheless, with moderate correlation
    (0.5), the probability that a 15 cm tumor is less than 9 years old is only about
    1%.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在额外的实验中，我实现了一个选择具有串行相关性的生长速率的模拟；其效果是快速生长的肿瘤生长更快，而生长缓慢的肿瘤生长更慢。然而，对于中等相关性（0.5），15厘米肿瘤年龄小于9岁的概率只有约1%。
- en: The assumption that tumors are spherical is probably fine for tumors up to a
    few centimeters, but not for a tumor with linear dimensions 15.5 x 15 cm. If,
    as seems likely, a tumor this size is relatively flat, it might have the same
    volume as a 6 cm sphere. But even with this smaller volume and correlation 0.5,
    the probability that this tumor is less than 9 years old is about 5%.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 假设肿瘤是球形的假设对于直径不超过几厘米的肿瘤可能是合理的，但对于线性尺寸为15.5 x 15厘米的肿瘤来说可能不合适。如果像看起来那样，这样大小的肿瘤相对较扁，它的体积可能与6厘米的球体相同。但即使有了这个较小的体积和相关性0.5，这个肿瘤年龄小于9岁的概率约为5%。
- en: So even taking into account modeling errors, it is unlikely that such a large
    tumor could have formed after my correspondent retired from military service.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，即使考虑了建模误差，这样一个巨大的肿瘤在我的通讯者退伍后形成的可能性很小。
- en: The following figure shows the distribution of ages for tumors with diameters
    4, 8, and 15 cm.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 下图显示了直径为4、8和15厘米的肿瘤年龄分布。
- en: <details class="hide above-input"><summary aria-label="Toggle hidden content">Show
    code cell content Hide code cell content</summary>
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: <details class="hide above-input"><summary aria-label="Toggle hidden content">显示代码单元格内容
    隐藏代码单元格内容</summary>
- en: '[PRE30]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '![_images/df1b7e305f0bf055e7cb9eff94aa6e9b81aac9dc8f20186a88f92e867a20b50e.png](../Images/700c3256cc27fa31185ccc2cb7552e5f.png)</details>'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: '![_images/df1b7e305f0bf055e7cb9eff94aa6e9b81aac9dc8f20186a88f92e867a20b50e.png](../Images/700c3256cc27fa31185ccc2cb7552e5f.png)</details>'
- en: Approximate Bayesian Calculation
  id: totrans-120
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 近似贝叶斯计算
- en: At this point you might wonder why this example is in a book about Bayesian
    statistics. We never defined a prior distribution or did a Bayesian update. Why
    not? Because we didn’t have to.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，您可能会想知道为什么这个例子出现在一本关于贝叶斯统计的书中。我们从未定义先验分布或进行贝叶斯更新。为什么？因为我们不必这样做。
- en: Instead, we used simulations to compute ages and sizes for a collection of hypothetical
    tumors. Then, implicitly, we used the simulation results to form a joint distribution
    of age and size. If we select a column from the joint distribution, we get a distribution
    of size conditioned on age. If we select a row, we get a distribution of age conditioned
    on size.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，我们使用模拟来计算一系列假设肿瘤的年龄和大小。然后，我们隐式地使用模拟结果形成年龄和大小的联合分布。如果我们从联合分布中选择一列，我们得到一个在年龄条件下的大小分布。如果我们选择一行，我们得到一个在大小条件下的年龄分布。
- en: 'So this example is like the ones we saw in <<_Probability>>: if you have all
    of the data, you don’t need Bayes’s theorem; you can compute probabilities by
    counting.'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，这个例子就像我们在<<_Probability>>中看到的例子：如果你有所有的数据，你就不需要贝叶斯定理；你可以通过计数来计算概率。
- en: This example is a first step toward Approximate Bayesian Computation (ABC).
    The next example is a second step.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 这个例子是朝着近似贝叶斯计算（ABC）迈出的第一步。下一个例子是第二步。
- en: Counting Cells
  id: totrans-125
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 细胞计数
- en: This example comes from [this blog post](https://dataorigami.net/blogs/napkin-folding/bayesian-cell-counting),
    by Cameron Davidson-Pilon. In it, he models the process biologists use to estimate
    the concentration of cells in a sample of liquid. The example he presents is counting
    cells in a “yeast slurry”, which is a mixture of yeast and water used in brewing
    beer.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 这个例子来自[这篇博客文章](https://dataorigami.net/blogs/napkin-folding/bayesian-cell-counting)，作者是Cameron
    Davidson-Pilon。在这篇文章中，他模拟了生物学家用来估计液体样本中细胞浓度的过程。他提出的例子是在“酵母浆”中计数细胞，这是酿造啤酒时使用的酵母和水的混合物。
- en: 'There are two steps in the process:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 这个过程有两个步骤：
- en: First, the slurry is diluted until the concentration is low enough that it is
    practical to count cells.
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 首先，将浆液稀释，直到浓度低到足够低，以至于可以计数细胞。
- en: Then a small sample is put on a hemocytometer, which is a specialized microscope
    slide that holds a fixed amount of liquid on a rectangular grid.
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 然后，将小样本放在一个血细胞计数板上，这是一个专门的显微镜载玻片，上面有一个固定数量的液体在一个矩形网格上。
- en: The cells and the grid are visible in a microscope, making it possible to count
    the cells accurately.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在显微镜中可以看到细胞和网格，从而可以准确计数细胞。
- en: As an example, suppose we start with a yeast slurry with unknown concentration
    of cells. Starting with a 1 mL sample, we dilute it by adding it to a shaker with
    9 mL of water and mixing well. Then we dilute it again, and then a third time.
    Each dilution reduces the concentration by a factor of 10, so three dilutions
    reduces the concentration by a factor of 1000.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 举个例子，假设我们从未知浓度的酵母浆开始。从1毫升样本开始，我们通过将其加入含9毫升水的摇床中并充分混合来稀释它。然后我们再次稀释，然后第三次。每次稀释都会将浓度减少10倍，因此三次稀释将浓度减少1000倍。
- en: Then we add the diluted sample to the hemocytometer, which has a capacity of
    0.0001 mL spread over a 5x5 grid. Although the grid has 25 squares, it is standard
    practice to inspect only a few of them, say 5, and report the total number of
    cells in the inspected squares.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们将稀释后的样本加入血细胞计数板，其容量为0.0001毫升，分布在一个5x5的网格上。尽管网格有25个方格，但通常只检查其中的一部分，比如5个，并报告检查方格中的细胞总数。
- en: 'This process is simple enough, but at every stage there are sources of error:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 这个过程足够简单，但在每个阶段都存在误差来源：
- en: During the dilution process, liquids are measured using pipettes that introduce
    measurement error.
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在稀释过程中，使用移液管测量液体时会引入测量误差。
- en: The amount of liquid in the hemocytometer might vary from the specification.
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 血细胞计数板中的液体量可能会与规格不同。
- en: During each step of the sampling process, we might select more or less than
    the average number of cells, due to random variation.
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在采样过程的每个步骤中，由于随机变化，我们可能选择的细胞数量多或少于平均值。
- en: Davidson-Pilon presents a PyMC model that describes these errors. I’ll start
    by replicating his model; then we’ll adapt it for ABC.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: Davidson-Pilon提出了一个描述这些错误的PyMC模型。我将首先复制他的模型；然后我们将为ABC进行调整。
- en: Suppose there are 25 squares in the grid, we count 5 of them, and the total
    number of cells is 49.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 假设网格中有25个方格，我们计数其中的5个，总细胞数为49。
- en: '[PRE31]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Here’s the first part of the model, which defines the prior distribution of
    `yeast_conc`, which is the concentration of yeast we’re trying to estimate.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是模型的第一部分，定义了`yeast_conc`的先验分布，即我们试图估计的酵母浓度。
- en: '`shaker1_vol` is the actual volume of water in the first shaker, which should
    be 9 mL, but might be higher or lower, with standard deviation 0.05 mL. `shaker2_vol`
    and `shaker3_vol` are the volumes in the second and third shakers.'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '`shaker1_vol`是第一个摇床中的水的实际体积，应为9毫升，但可能更高或更低，标准偏差为0.05毫升。`shaker2_vol`和`shaker3_vol`是第二个和第三个摇床中的体积。'
- en: '[PRE32]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Now, the sample drawn from the yeast slurry is supposed to be 1 mL, but might
    be more or less. And similarly for the sample from the first shaker and from the
    second shaker. The following variables model these steps.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，从酵母浆中抽取的样本应该是1毫升，但可能更多或更少。同样，第一个摇床和第二个摇床的样本也是如此。以下变量模拟了这些步骤。
- en: '[PRE33]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Given the actual volumes in the samples and in the shakers, we can compute the
    effective dilution, `final_dilution`, which should be 1000, but might be higher
    or lower.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 鉴于样本和摇床中的实际体积，我们可以计算有效稀释`final_dilution`，应为1000，但可能更高或更低。
- en: '[PRE34]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: The next step is to place a sample from the third shaker in the chamber of the
    hemocytomer. The capacity of the chamber should be 0.0001 mL, but might vary;
    to describe this variance, we’ll use a gamma distribution, which ensures that
    we don’t generate negative values.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是将第三个摇床的样本放入血细胞计数板的仓室中。仓室的容量应为0.0001毫升，但可能会有所不同；为了描述这种差异，我们将使用伽玛分布，以确保我们不会产生负值。
- en: '[PRE35]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: On average, the number of cells in the chamber is the product of the actual
    concentration, final dilution, and chamber volume. But the actual number might
    vary; we’ll use a Poisson distribution to model this variance.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 平均而言，仓室中的细胞数量是实际浓度、最终稀释和仓室容积的乘积。但实际数量可能会有所不同；我们将使用泊松分布来模拟这种差异。
- en: '[PRE36]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Finally, each cell in the chamber will be in one of the squares we count with
    probability `p=squares_counted/total_squares`. So the actual count follows a binomial
    distribution.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，仓室中的每个细胞都有一定概率位于我们计数的方格中，概率为`p=squares_counted/total_squares`。因此，实际计数遵循二项分布。
- en: '[PRE37]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: With the model specified, we can use `sample` to generate a sample from the
    posterior distribution.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 模型指定后，我们可以使用`sample`从后验分布中生成样本。
- en: '[PRE38]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: <details class="hide below-input"><summary aria-label="Toggle hidden content">Show
    code cell output Hide code cell output</summary>
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: <details class="hide below-input"><summary aria-label="Toggle hidden content">Show
    code cell output Hide code cell output</summary>
- en: '[PRE39]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: '<progress value="4000" class="" max="4000" style="width:300px; height:20px;
    vertical-align: middle;">100.00% [4000/4000 00:03<00:00 Sampling 2 chains, 0 divergences]</progress>'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: '<progress value="4000" class="" max="4000" style="width:300px; height:20px;
    vertical-align: middle;">100.00% [4000/4000 00:03<00:00 Sampling 2 chains, 0 divergences]</progress>'
- en: '[PRE40]</details>'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE40]</details>'
- en: And we can use the sample to estimate the posterior distribution of `yeast_conc`
    and compute summary statistics.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用样本来估计`yeast_conc`的后验分布并计算摘要统计信息。
- en: '[PRE41]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: '[PRE42]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: The posterior mean is about 2.3 billion cells per mL, with a 90% credible interval
    from 1.8 and 2.7.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 后验均值约为每毫升23亿个细胞，90%的可信区间为18亿到27亿。
- en: So far we’ve been following in Davidson-Pilon’s footsteps. And for this problem,
    the solution using MCMC is sufficient. But it also provides an opportunity to
    demonstrate ABC.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们一直在追随Davidson-Pilon的脚步。对于这个问题，使用MCMC的解决方案已经足够。但它也提供了一个展示ABC的机会。
- en: Cell Counting with ABC
  id: totrans-164
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用ABC进行细胞计数
- en: The fundamental idea of ABC is that we use the prior distribution to generate
    a sample of the parameters, and then simulate the system for each set of parameters
    in the sample.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: ABC的基本思想是，我们使用先验分布生成参数的样本，然后为样本中的每组参数模拟系统。
- en: In this case, since we already have a PyMC model, we can use `sample_prior_predictive`
    to do the sampling and the simulation.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，由于我们已经有一个PyMC模型，我们可以使用`sample_prior_predictive`来进行抽样和模拟。
- en: '[PRE43]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: The result is a dictionary that contains samples from the prior distribution
    of the parameters and the prior predictive distribution of `count`.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是一个包含参数先验分布和`count`的先验预测分布样本的字典。
- en: '[PRE44]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: '[PRE45]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: Now, to generate a sample from the posterior distribution, we’ll select only
    the elements in the prior sample where the output of the simulation, `count`,
    matches the observed data, 49.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，为了从后验分布中生成样本，我们将仅选择模拟中输出`count`与观察数据49匹配的先验样本中的元素。
- en: '[PRE46]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: '[PRE47]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: We can use `mask` to select the values of `yeast_conc` for the simulations that
    yield the observed data.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`mask`来选择产生观察数据的模拟的`yeast_conc`的值。
- en: '[PRE48]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: And we can use the posterior sample to estimate the CDF of the posterior distribution.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用后验样本来估计后验分布的CDF。
- en: '[PRE49]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: '[PRE50]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: The posterior mean and credible interval are similar to what we got with MCMC.
    Here’s what the distributions look like.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 后验均值和可信区间与MCMC得到的类似。以下是分布的样子。
- en: <details class="hide above-input"><summary aria-label="Toggle hidden content">Show
    code cell source Hide code cell source</summary>
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: <details class="hide above-input"><summary aria-label="Toggle hidden content">显示代码单元格源代码
    隐藏代码单元格源代码</summary>
- en: '[PRE51]</details> ![_images/8eaa208c16fc79c79edb3769816e14528e9b03eb810bc1d301ecdc95ce329632.png](../Images/1d23154bcad37ebbc595c0be66cb4554.png)'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE51]</details> ![_images/8eaa208c16fc79c79edb3769816e14528e9b03eb810bc1d301ecdc95ce329632.png](../Images/1d23154bcad37ebbc595c0be66cb4554.png)'
- en: The distributions are similar, but the results from ABC are noisier because
    the sample size is smaller.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 这些分布是相似的，但ABC的结果更嘈杂，因为样本量较小。
- en: When Do We Get to the Approximate Part?
  id: totrans-183
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 何时到达近似部分？
- en: 'The examples so far are similar to Approximate Bayesian Computation, but neither
    of them demonstrates all of the elements of ABC. More generally, ABC is characterized
    by:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止的示例类似于近似贝叶斯计算，但它们都没有展示ABC的所有元素。更一般地，ABC的特点是：
- en: A prior distribution of parameters.
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 参数的先验分布。
- en: A simulation of the system that generates the data.
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成数据的系统的模拟。
- en: A criterion for when we should accept that the output of the simulation matches
    the data.
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们应该接受模拟输出与数据匹配的标准。
- en: The kidney tumor example was atypical because we didn’t represent the prior
    distribution of age explicitly. Because the simulations generate a joint distribution
    of age and size, we we able to get the marginal posterior distribution of age
    directly from the results.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 肾脏肿瘤示例是不典型的，因为我们没有明确表示年龄的先验分布。因为模拟生成年龄和大小的联合分布，我们能够直接从结果中获得年龄的边际后验分布。
- en: The yeast example is more typical because we represented the distribution of
    the parameters explicitly. But we accepted only simulations where the output matches
    the data exactly.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 酵母示例更典型，因为我们明确表示了参数的分布。但我们只接受输出与数据完全匹配的模拟。
- en: The result is approximate in the sense that we have a sample from the posterior
    distribution rather than the posterior distribution itself. But it is not approximate
    in the sense of Approximate Bayesian Computation, which typically accepts simulations
    where the output matches the data only approximately.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是近似的，因为我们有来自后验分布的样本，而不是后验分布本身。但它在近似贝叶斯计算的意义上并不是近似的，通常接受输出与数据仅近似匹配的模拟。
- en: To show how that works, I will extend the yeast example with an approximate
    matching criterion.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 为了展示这是如何工作的，我将使用近似匹配标准扩展酵母示例。
- en: In the previous section, we accepted a simulation if the output is precisely
    49 and rejected it otherwise. As a result, we got only a few hundred samples out
    of 10,000 simulations, so that’s not very efficient.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一节中，如果输出恰好为49，则接受模拟，否则拒绝。结果，我们只从10000次模拟中得到了几百个样本，所以效率不是很高。
- en: We can make better use of the simulations if we give “partial credit” when the
    output is close to 49. But how close? And how much credit?
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们在输出接近49时给予“部分信用”，我们可以更好地利用模拟。但是多接近？以及多少信用？
- en: One way to answer that is to back up to the second-to-last step of the simulation,
    where we know the number of cells in the chamber, and we use the binomial distribution
    to generate the final count.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 回答这个问题的一种方法是回到模拟的倒数第二步，我们知道室内的单元数，并使用二项分布生成最终计数。
- en: If there are `n` cells in the chamber, each has a probability `p` of being counted,
    depending on whether it falls in one of the squares in the grid that get counted.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有`n`个单元在室内，每个单元有一个概率`p`被计数，这取决于它是否落在网格中的一个方格中被计数。
- en: 'We can extract `n` from the prior sample, like this:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以从先验样本中提取`n`，像这样：
- en: '[PRE52]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: '[PRE53]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'And compute `p` like this:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 并且像这样计算`p`：
- en: '[PRE54]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: '[PRE55]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Now here’s the idea: we’ll use the binomial distribution to compute the likelihood
    of the data, `yeast_counted`, for each value of `n` and the fixed value of `p`.'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 现在的想法是：我们将使用二项分布来计算数据`yeast_counted`的似然，对于每个`n`的值和固定值`p`。
- en: '[PRE56]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: <details class="hide above-input"><summary aria-label="Toggle hidden content">Show
    code cell content Hide code cell content</summary>
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: <details class="hide above-input"><summary aria-label="Toggle hidden content">显示代码单元格内容
    隐藏代码单元格内容</summary>
- en: '[PRE57]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: '[PRE58]</details>'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE58]</details>'
- en: When the expected count, `n * p`, is close to the actual count, `likelihood`
    is relatively high; when it is farther away, `likelihood` is lower.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 当期望计数`n * p`接近实际计数时，`likelihood`相对较高；当它距离较远时，`likelihood`较低。
- en: The following is a scatter plot of these likelihoods versus the expected counts.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是这些likelihoods与期望计数的散点图。
- en: <details class="hide above-input"><summary aria-label="Toggle hidden content">Show
    code cell source Hide code cell source</summary>
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: <details class="hide above-input"><summary aria-label="Toggle hidden content">显示代码单元格源代码
    隐藏代码单元格源代码</summary>
- en: '[PRE59]</details> ![_images/b236c7fa22cca34323d3de3073ad4b52b044a670cfb4661663bb69c0e81373d7.png](../Images/f3e3c9ba995ba9209c11aeb7bdd7e598.png)'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE59]</details> ![_images/b236c7fa22cca34323d3de3073ad4b52b044a670cfb4661663bb69c0e81373d7.png](../Images/f3e3c9ba995ba9209c11aeb7bdd7e598.png)'
- en: We can’t use these likelihoods to do a Bayesian update because they are incomplete;
    that is, each likelihood is the probability of the data given `n`, which is the
    result of a single simulation.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
- en: But we *can* use them to weight the results of the simulations. Instead of requiring
    the output of the simulation to match the data exactly, we’ll use the likelihoods
    to give partial credit when the output is close.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
- en: 'Here’s how: I’ll construct a `Pmf` that contains yeast concentrations as quantities
    and the likelihoods as unnormalized probabilities.'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE60]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: In this `Pmf`, values of `yeast_conc` that yield outputs close to the data map
    to higher probabilities. If we sort the quantities and normalize the probabilities,
    the result is an estimate of the posterior distribution.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE61]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: '[PRE62]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: The posterior mean and credible interval are similar to the values we got from
    MCMC. And here’s what the posterior distributions look like.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
- en: <details class="hide above-input"><summary aria-label="Toggle hidden content">Show
    code cell source Hide code cell source</summary>
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE63]</details> ![_images/49f8337976b730ce868462a4375483b9c032020dffdd39b08ca9b6e4e7958f12.png](../Images/c6ee6e1a0295e2dde4fef1b17e5f9b3f.png)'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
- en: The distributions are similar, but the results from MCMC are a little noisier.
    In this example, ABC is more efficient than MCMC, requiring less computation to
    generate a better estimate of the posterior distribution. But that’s unusual;
    usually ABC requires a lot of computation. For that reason, it is generally a
    method of last resort.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  id: totrans-222
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this chapter we saw two examples of Approximate Bayesian Computation (ABC),
    based on simulations of tumor growth and cell counting.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
- en: 'The definitive elements of ABC are:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
- en: A prior distribution of parameters.
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: A simulation of the system that generates the data.
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: A criterion for when we should accept that the output of the simulation matches
    the data.
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: ABC is particularly useful when the system is too complex to model with tools
    like PyMC. For example, it might involve a physical simulation based on differential
    equations. In that case, each simulation might require substantial computation,
    and many simulations might be needed to estimate the posterior distribution.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
- en: Next, you’ll have a chance to practice with one more example.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
- en: Exercises
  id: totrans-230
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**Exercise:** This exercise is based on [a blog post by Rasmus Bååth](http://www.sumsar.net/blog/2014/10/tiny-data-and-the-socks-of-karl-broman),
    which is motivated by a tweet from Karl Broman, who wrote:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
- en: That the first 11 socks in the laundry are distinct suggests that there are
    a lot of socks.
  id: totrans-232
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Suppose you pull 11 socks out of the laundry and find that no two of them make
    a matched pair. Estimate the number of socks in the laundry.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
- en: 'To solve this problem, we’ll use the model Bååth suggests, which is based on
    these assumptions:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
- en: The laundry contains some number of pairs of socks, `n_pairs`, plus some number
    of odd (unpaired) socks, `n_odds`.
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The pairs of socks are different from each other and different from the unpaired
    socks; in other words, the number of socks of each type is either 1 or 2, never
    more.
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We’ll use the prior distributions Bååth suggests, which are:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
- en: The number of socks follows a negative binomial distribution with mean 30 and
    standard deviation 15.
  id: totrans-238
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The proportion of socks that are paired follows a beta distribution with parameters
    `alpha=15` and `beta=2`.
  id: totrans-239
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the notebook for this chapter, I’ll define these priors. Then you can simulate
    the sampling process and use ABC to estimate the posterior distributions.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
- en: <details class="hide above-input"><summary aria-label="Toggle hidden content">Show
    code cell content Hide code cell content</summary>
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE64]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: '[PRE65]</details> <details class="hide above-input"><summary aria-label="Toggle
    hidden content">Show code cell content Hide code cell content</summary>'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE66]'
  id: totrans-244
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: '[PRE67]</details> <details class="hide above-input"><summary aria-label="Toggle
    hidden content">Show code cell content Hide code cell content</summary>'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE68]'
  id: totrans-246
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: '[PRE69]</details> <details class="hide above-input"><summary aria-label="Toggle
    hidden content">Show code cell content Hide code cell content</summary>'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE69] </details> <details class="hide above-input"><summary aria-label="切换隐藏内容">显示代码单元格内容
    隐藏代码单元格内容</summary>'
- en: '[PRE70]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: '[PRE71]</details> <details class="hide above-input"><summary aria-label="Toggle
    hidden content">Show code cell content Hide code cell content</summary>'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE71] </details> <details class="hide above-input"><summary aria-label="切换隐藏内容">显示代码单元格内容
    隐藏代码单元格内容</summary>'
- en: '[PRE72]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: '[PRE73]</details> <details class="hide above-input"><summary aria-label="Toggle
    hidden content">Show code cell content Hide code cell content</summary>'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE73] </details> <details class="hide above-input"><summary aria-label="切换隐藏内容">显示代码单元格内容
    隐藏代码单元格内容</summary>'
- en: '[PRE74]</details> <details class="hide above-input"><summary aria-label="Toggle
    hidden content">Show code cell content Hide code cell content</summary>'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE74] </details> <details class="hide above-input"><summary aria-label="切换隐藏内容">显示代码单元格内容
    隐藏代码单元格内容</summary>'
- en: '[PRE75]'
  id: totrans-253
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: '[PRE76]</details> <details class="hide above-input"><summary aria-label="Toggle
    hidden content">Show code cell content Hide code cell content</summary>'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE76] </details> <details class="hide above-input"><summary aria-label="切换隐藏内容">显示代码单元格内容
    隐藏代码单元格内容</summary>'
- en: '[PRE77]'
  id: totrans-255
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: '[PRE78]</details> <details class="hide above-input"><summary aria-label="Toggle
    hidden content">Show code cell content Hide code cell content</summary>'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE78] </details> <details class="hide above-input"><summary aria-label="切换隐藏内容">显示代码单元格内容
    隐藏代码单元格内容</summary>'
- en: '[PRE79]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: '|  | n_socks | n_pairs | n_odds |'
  id: totrans-258
  prefs: []
  type: TYPE_TB
  zh: '|  | n_socks | n_pairs | n_odds |'
- en: '| --- | --- | --- | --- |'
  id: totrans-259
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| 0 | 52 | 25.0 | 2.0 |'
  id: totrans-260
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 52 | 25.0 | 2.0 |'
- en: '| 1 | 54 | 26.0 | 2.0 |'
  id: totrans-261
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 54 | 26.0 | 2.0 |'
- en: '| 2 | 41 | 18.0 | 5.0 |'
  id: totrans-262
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 41 | 18.0 | 5.0 |'
- en: '| 3 | 35 | 14.0 | 7.0 |'
  id: totrans-263
  prefs: []
  type: TYPE_TB
  zh: '| 3 | 35 | 14.0 | 7.0 |'
- en: '| 4 | 57 | 19.0 | 19.0 |</details> <details class="hide above-input"><summary
    aria-label="Toggle hidden content">Show code cell content Hide code cell content</summary>'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: '| 4 | 57 | 19.0 | 19.0 |</details> <details class="hide above-input"><summary
    aria-label="切换隐藏内容">显示代码单元格内容 隐藏代码单元格内容</summary>'
- en: '[PRE80]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: '[PRE81]</details> <details class="hide above-input"><summary aria-label="Toggle
    hidden content">Show code cell content Hide code cell content</summary>'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE81] </details> <details class="hide above-input"><summary aria-label="切换隐藏内容">显示代码单元格内容
    隐藏代码单元格内容</summary>'
- en: '[PRE82]'
  id: totrans-267
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: '![_images/c50294d3bdbfeea2193671a474d85658c75f9e858b4eefdea006ede9e1f375b7.png](../Images/ee25da0b52382108ec7bab5e7f748b43.png)</details>'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: '![_images/c50294d3bdbfeea2193671a474d85658c75f9e858b4eefdea006ede9e1f375b7.png](../Images/ee25da0b52382108ec7bab5e7f748b43.png)</details>'

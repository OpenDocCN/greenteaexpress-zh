- en: Chapter 13  Survival analysis
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第13章  生存分析
- en: 原文：[https://greenteapress.com/thinkstats2/html/thinkstats2014.html](https://greenteapress.com/thinkstats2/html/thinkstats2014.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://greenteapress.com/thinkstats2/html/thinkstats2014.html](https://greenteapress.com/thinkstats2/html/thinkstats2014.html)
- en: Survival analysis is a way to describe how long things last. It is often used
    to study human lifetimes, but it also applies to “survival” of mechanical and
    electronic components, or more generally to intervals in time before an event.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 生存分析是描述事物持续多久的一种方法。它经常用于研究人类寿命，但也适用于机械和电子部件的“生存”，或者更一般地说，适用于事件发生前的时间间隔。
- en: If someone you know has been diagnosed with a life-threatening disease, you
    might have seen a “5-year survival rate,” which is the probability of surviving
    five years after diagnosis. That estimate and related statistics are the result
    of survival analysis.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你认识有人被诊断患有危及生命的疾病，你可能见过“5年生存率”，这是诊断后存活五年的概率。这一估计和相关统计数据是生存分析的结果。
- en: The code in this chapter is in `survival.py`. For information about downloading
    and working with this code, see Section [0.2](thinkstats2001.html#code).
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的代码在`survival.py`中。有关下载和使用此代码的信息，请参见第[0.2](thinkstats2001.html#code)节。
- en: 13.1  Survival curves
  id: totrans-5
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.1  生存曲线
- en: 'The fundamental concept in survival analysis is the survival curve, S(t), which
    is a function that maps from a duration, t, to the probability of surviving longer
    than t. If you know the distribution of durations, or “lifetimes”, finding the
    survival curve is easy; it’s just the complement of the CDF:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 生存分析中的基本概念是生存曲线S(t)，它是一个将持续时间t映射到生存时间长于t的概率的函数。如果你知道持续时间或“寿命”的分布，找到生存曲线就很容易；它只是CDF的补集：
- en: '| S(t) = 1 − CDF (t)  |'
  id: totrans-7
  prefs: []
  type: TYPE_TB
  zh: '| S(t) = 1 − CDF (t)  |'
- en: where CDF (t) is the probability of a lifetime less than or equal to t.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 其中CDF(t)是寿命小于或等于t的概率。
- en: 'For example, in the NSFG dataset, we know the duration of 11189 complete pregnancies.
    We can read this data and compute the CDF:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，在NSFG数据集中，我们知道11189个完整怀孕的持续时间。我们可以读取这些数据并计算CDF：
- en: '[PRE0]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The outcome codes `1, 3, 4` indicate live birth, stillbirth, and miscarriage.
    For this analysis I am excluding induced abortions, ectopic pregnancies, and pregnancies
    that were in progress when the respondent was interviewed.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 结果代码`1, 3, 4`表示活产、死胎和流产。在这个分析中，我排除了人工流产、异位妊娠和在受访者接受采访时正在进行的怀孕。
- en: The DataFrame method `query` takes a boolean expression and evaluates it for
    each row, selecting the rows that yield True.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: DataFrame方法`query`接受一个布尔表达式并对每一行进行评估，选择产生True的行。
- en: '* * *'
  id: totrans-13
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '* * *'
- en: ''
  id: totrans-14
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](../Images/8ea3f9be2a9ea8f19e95caa5a8d61c75.png)'
  id: totrans-15
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](../Images/8ea3f9be2a9ea8f19e95caa5a8d61c75.png)'
- en: ''
  id: totrans-16
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| Figure 13.1: Cdf and survival curve for pregnancy length (top), hazard curve
    (bottom). |'
  id: totrans-17
  prefs:
  - PREF_BQ
  type: TYPE_TB
  zh: '| 图13.1：怀孕期长度的CDF和生存曲线（顶部），危险曲线（底部）。 |'
- en: ''
  id: totrans-18
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-19
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '* * *'
- en: 'Figure [13.1](#survival1) (top) shows the CDF of pregnancy length and its complement,
    the survival curve. To represent the survival curve, I define an object that wraps
    a Cdf and adapts the interface:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 图[13.1](#survival1)（顶部）显示了怀孕期长度的CDF及其补集，即生存曲线。为了表示生存曲线，我定义了一个包装CDF并适应接口的对象：
- en: '[PRE1]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '`SurvivalFunction` provides two properties: `ts`, which is the sequence of
    lifetimes, and `ss`, which is the survival curve. In Python, a “property” is a
    method that can be invoked as if it were a variable.'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '`SurvivalFunction`提供了两个属性：`ts`，它是寿命的序列，`ss`，它是生存曲线。在Python中，“属性”是一个可以像变量一样调用的方法。'
- en: 'We can instantiate a `SurvivalFunction` by passing the CDF of lifetimes:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过传递寿命的CDF来实例化`SurvivalFunction`：
- en: '[PRE2]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '`SurvivalFunction` also provides `__getitem__` and `Prob`, which evaluates
    the survival curve:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '`SurvivalFunction`还提供了`__getitem__`和`Prob`，用于评估生存曲线。'
- en: '[PRE3]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'For example, `sf[13]` is the fraction of pregnancies that proceed past the
    first trimester:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，`sf[13]`是持续到第一孕期后的怀孕的比例：
- en: '[PRE4]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: About 86% of pregnancies proceed past the first trimester; about 14% do not.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 大约86%的怀孕在第一孕期后继续进行；大约14%不会。
- en: '`SurvivalFunction` provides `Render`, so we can plot `sf` using the functions
    in `thinkplot`:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '`SurvivalFunction`还提供了`Render`，所以我们可以使用`thinkplot`中的函数绘制`sf`：'
- en: '[PRE5]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Figure [13.1](#survival1) (top) shows the result. The curve is nearly flat between
    13 and 26 weeks, which shows that few pregnancies end in the second trimester.
    And the curve is steepest around 39 weeks, which is the most common pregnancy
    length.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 图[13.1](#survival1)（顶部）显示了结果。曲线在13到26周之间几乎是平的，这表明很少的怀孕在第二孕期结束。曲线在39周左右最陡，这是最常见的怀孕期长。
- en: 13.2  Hazard function
  id: totrans-33
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.2  危险函数
- en: 'From the survival curve we can derive the hazard function; for pregnancy lengths,
    the hazard function maps from a time, t, to the fraction of pregnancies that continue
    until t and then end at t. To be more precise:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 从生存曲线中，我们可以推导出危险函数；对于怀孕期长度，危险函数从时间t映射到继续进行直到t然后在t结束的怀孕的比例。更准确地说：
- en: '| λ(t) =  |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| λ(t) =  |'
- en: '&#124; S(t) − S(t+1) &#124;'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124; S(t) − S(t+1) &#124;'
- en: '&#124;  &#124;'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124;  &#124;'
- en: '&#124; S(t) &#124;'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '&#124; S(t) &#124;'
- en: '|   |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '|   |'
- en: The numerator is the fraction of lifetimes that end at t, which is also PMF(t).
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 分子是在t结束的寿命的比例，也是PMF(t)。
- en: '`SurvivalFunction` provides `MakeHazard`, which calculates the hazard function:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '`SurvivalFunction`提供了`MakeHazard`，它计算危险函数：'
- en: '[PRE6]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The `HazardFunction` object is a wrapper for a pandas Series:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: '`HazardFunction`对象是pandas Series的包装器：'
- en: '[PRE7]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '`d` can be a dictionary or any other type that can initialize a Series, including
    another Series. `label` is a string used to identify the HazardFunction when plotted.'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '`d`可以是一个字典或任何其他可以初始化Series的类型，包括另一个Series。`label`是用于标识HazardFunction的字符串。'
- en: '`HazardFunction` provides `__getitem__`, so we can evaluate it like this:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '`HazardFunction`提供了`__getitem__`，所以我们可以这样评估它：'
- en: '[PRE8]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: So of all pregnancies that proceed until week 39, about 50% end in week 39.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在所有持续到第39周的怀孕中，大约50%在第39周结束。
- en: 'Figure [13.1](#survival1) (bottom) shows the hazard function for pregnancy
    lengths. For times after week 42, the hazard function is erratic because it is
    based on a small number of cases. Other than that the shape of the curve is as
    expected: it is highest around 39 weeks, and a little higher in the first trimester
    than in the second.'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 图[13.1](#survival1)（底部）显示了怀孕期长度的危险函数。在42周后的时间，危险函数是不稳定的，因为它是基于少量案例。除此之外，曲线的形状如预期的那样：在39周左右最高，在第一孕期比第二孕期略高。
- en: The hazard function is useful in its own right, but it is also an important
    tool for estimating survival curves, as we’ll see in the next section.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 危险函数本身就很有用，但它也是估计生存曲线的重要工具，我们将在下一节中看到。
- en: 13.3  Inferring survival curves
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.3 推断生存曲线
- en: If someone gives you the CDF of lifetimes, it is easy to compute the survival
    and hazard functions. But in many real-world scenarios, we can’t measure the distribution
    of lifetimes directly. We have to infer it.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有人给您寿命的CDF，那么计算生存和危险函数就很容易。但在许多现实世界的情况下，我们无法直接测量寿命的分布。我们必须推断它。
- en: For example, suppose you are following a group of patients to see how long they
    survive after diagnosis. Not all patients are diagnosed on the same day, so at
    any point in time, some patients have survived longer than others. If some patients
    have died, we know their survival times. For patients who are still alive, we
    don’t know survival times, but we have a lower bound.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，假设您正在跟踪一组患者，以查看他们在诊断后存活多长时间。并非所有患者在同一天被诊断，因此在任何时间点，有些患者的存活时间比其他患者长。如果有些患者已经去世，我们知道他们的存活时间。对于仍然存活的患者，我们不知道存活时间，但我们有一个下限。
- en: If we wait until all patients are dead, we can compute the survival curve, but
    if we are evaluating the effectiveness of a new treatment, we can’t wait that
    long! We need a way to estimate survival curves using incomplete information.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们等到所有患者都去世，我们可以计算生存曲线，但如果我们正在评估一种新治疗的有效性，我们不能等那么久！我们需要一种方法来使用不完整信息估计生存曲线。
- en: As a more cheerful example, I will use NSFG data to quantify how long respondents
    “survive” until they get married for the first time. The range of respondents’
    ages is 14 to 44 years, so the dataset provides a snapshot of women at different
    stages in their lives.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一个更愉快的例子，我将使用NSFG数据来量化respondents首次结婚“存活”多长时间。respondents年龄的范围是14到44岁，因此数据集提供了生活不同阶段的女性的快照。
- en: For women who have been married, the dataset includes the date of their first
    marriage and their age at the time. For women who have not been married, we know
    their age when interviewed, but have no way of knowing when or if they will get
    married.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 对于已婚的女性，数据集包括她们的第一次婚姻日期和当时的年龄。对于未婚的女性，我们知道她们接受采访时的年龄，但无法知道她们何时或是否会结婚。
- en: 'Since we know the age at first marriage for *some* women, it might be tempting
    to exclude the rest and compute the CDF of the known data. That is a bad idea.
    The result would be doubly misleading: (1) older women would be overrepresented,
    because they are more likely to be married when interviewed, and (2) married women
    would be overrepresented! In fact, this analysis would lead to the conclusion
    that all women get married, which is obviously incorrect.'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们知道*一些*女性的初婚年龄，可能会诱人地排除其他女性并计算已知数据的CDF。这是一个坏主意。结果会产生双重误导：（1）年龄较大的女性会被过度代表，因为她们更有可能在接受采访时已婚，（2）已婚女性会被过度代表！实际上，这种分析会导致结论所有女性都结婚，这显然是不正确的。
- en: 13.4  Kaplan-Meier estimation
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.4 Kaplan-Meier 估计
- en: In this example it is not only desirable but necessary to include observations
    of unmarried women, which brings us to one of the central algorithms in survival
    analysis, Kaplan-Meier estimation.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，不仅是值得的，而且是必要的，包括未婚女性的观察结果，这将引出生存分析中的一个中心算法之一，Kaplan-Meier估计。
- en: The general idea is that we can use the data to estimate the hazard function,
    then convert the hazard function to a survival curve. To estimate the hazard function,
    we consider, for each age, (1) the number of women who got married at that age
    and (2) the number of women “at risk” of getting married, which includes all women
    who were not married at an earlier age.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 总体思想是我们可以使用数据来估计危险函数，然后将危险函数转换为生存曲线。为了估计危险函数，我们考虑每个年龄的（1）在该年龄结婚的女性人数和（2）“处于风险”结婚的女性人数，其中包括所有在较早年龄未婚的女性。
- en: 'Here’s the code:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是代码：
- en: '[PRE9]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '`complete` is the set of complete observations; in this case, the ages when
    respondents got married. `ongoing` is the set of incomplete observations; that
    is, the ages of unmarried women when they were interviewed.'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '`complete`是完整观察的集合；在这种情况下，是respondents结婚时的年龄。`ongoing`是不完整观察的集合；也就是说，在被采访时未婚女性的年龄。'
- en: First, we precompute `hist_complete`, which is a Counter that maps from each
    age to the number of women married at that age, and `hist_ongoing` which maps
    from each age to the number of unmarried women interviewed at that age.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们预先计算`hist_complete`，它是一个计数器，将每个年龄映射到在该年龄结婚的女性人数，以及`hist_ongoing`，它将每个年龄映射到在该年龄接受采访的未婚女性人数。
- en: '`ts` is the union of ages when respondents got married and ages when unmarried
    women were interviewed, sorted in increasing order.'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '`ts`是respondents结婚时的年龄和未婚女性接受采访时的年龄的并集，按增加顺序排序。'
- en: '`at_risk` keeps track of the number of respondents considered “at risk” at
    each age; initially, it is the total number of respondents.'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '`at_risk` 跟踪被认为在每个年龄“处于风险”respondents的数量；最初，它是respondents的总数。'
- en: The result is stored in a Pandas `Series` that maps from each age to the estimated
    hazard function at that age.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 结果存储在一个Pandas `Series`中，该系列将每个年龄映射到该年龄的估计危险函数。
- en: Each time through the loop, we consider one age, `t`, and compute the number
    of events that end at `t` (that is, the number of respondents married at that
    age) and the number of events censored at `t` (that is, the number of women interviewed
    at `t` whose future marriage dates are censored). In this context, “censored”
    means that the data are unavailable because of the data collection process.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 每次循环时，我们考虑一个年龄`t`，并计算在`t`结束的事件数（即在该年龄结婚的受访者人数）以及在`t`被截尾的事件数（即在`t`接受采访的女性中，未来结婚日期被截尾的人数）。在这种情况下，“被截尾”意味着由于数据收集过程而无法获得数据。
- en: The estimated hazard function is the fraction of the cases at risk that end
    at `t`.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 估计的危险函数是在`t`结束的风险案例的比例。
- en: At the end of the loop, we subtract from `at_risk` the number of cases that
    ended or were censored at `t`.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在循环结束时，我们从`at_risk`中减去在`t`结束或被截尾的案例数。
- en: Finally, we pass `lams` to the `HazardFunction` constructor and return the result.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们将`lams`传递给`HazardFunction`构造函数并返回结果。
- en: 13.5  The marriage curve
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.5 婚姻曲线
- en: 'To test this function, we have to do some data cleaning and transformation.
    The NSFG variables we need are:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 为了测试这个函数，我们需要进行一些数据清理和转换。我们需要的NSFG变量是：
- en: '`cmbirth`: The respondent’s date of birth, known for all respondents.'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cmbirth`：受访者的出生日期，对所有受访者都已知。'
- en: '`cmintvw`: The date the respondent was interviewed, known for all respondents.'
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cmintvw`：受访者接受采访的日期，对所有受访者都已知。'
- en: '`cmmarrhx`: The date the respondent was first married, if applicable and known.'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`cmmarrhx`：如果适用且已知，受访者首次结婚的日期。'
- en: '`evrmarry`: 1 if the respondent had been married prior to the date of interview,
    0 otherwise.'
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`evrmarry`：如果受访者在采访日期之前结过婚，则为1，否则为0。'
- en: The first three variables are encoded in “century-months”; that is, the integer
    number of months since December 1899\. So century-month 1 is January 1900.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 前三个变量以“世纪-月”编码；即自1899年12月以来的整数月数。所以世纪-月1是1900年1月。
- en: 'First, we read the respondent file and replace invalid values of `cmmarrhx`:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们读取受访者文件并替换`cmmarrhx`的无效值：
- en: '[PRE10]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Then we compute each respondent’s age when married and age when interviewed:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们计算每个受访者的结婚年龄和接受采访时的年龄：
- en: '[PRE11]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Next we extract `complete`, which is the age at marriage for women who have
    been married, and `ongoing`, which is the age at interview for women who have
    not:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来我们提取`complete`，这是已婚妇女的结婚年龄，以及`ongoing`，这是未婚妇女的采访年龄：
- en: '[PRE12]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Finally we compute the hazard function.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 最后我们计算危险函数。
- en: '[PRE13]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Figure [13.2](#survival2) (top) shows the estimated hazard function; it is low
    in the teens, higher in the 20s, and declining in the 30s. It increases again
    in the 40s, but that is an artifact of the estimation process; as the number of
    respondents “at risk” decreases, a small number of women getting married yields
    a large estimated hazard. The survival curve will smooth out this noise.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 图[13.2](#survival2)（顶部）显示了估计的危险函数；在十几岁时较低，在20多岁时较高，在30多岁时下降。在40多岁时再次增加，但这是估计过程的产物；随着“处于风险中”的受访者数量减少，少数结婚的女性产生了较大的估计危险。生存曲线将平滑这种噪音。
- en: 13.6  Estimating the survival curve
  id: totrans-88
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.6 估计生存曲线
- en: 'Once we have the hazard function, we can estimate the survival curve. The chance
    of surviving past time `t` is the chance of surviving all times up through `t`,
    which is the cumulative product of the complementary hazard function:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们有了危险函数，我们就可以估计生存曲线。在时间`t`之后生存的机会是在`t`之前所有时间生存的机会，这是补集危险函数的累积乘积：
- en: '| [1−λ(0)] [1−λ(1)] … [1−λ(t)]  |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
  zh: '| [1−λ(0)] [1−λ(1)] … [1−λ(t)] |'
- en: 'The `HazardFunction` class provides `MakeSurvival`, which computes this product:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '`HazardFunction`类提供了`MakeSurvival`，计算这个乘积：'
- en: '[PRE14]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '`ts` is the sequence of times where the hazard function is estimated. `ss`
    is the cumulative product of the complementary hazard function, so it is the survival
    curve.'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '`ts`是估计危险函数的时间序列。`ss`是补集危险函数的累积乘积，因此它是生存曲线。'
- en: Because of the way `SurvivalFunction` is implemented, we have to compute the
    complement of `ss`, make a Cdf, and then instantiate a SurvivalFunction object.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 由于`SurvivalFunction`的实现方式，我们必须计算`ss`的补集，制作一个Cdf，然后实例化一个SurvivalFunction对象。
- en: '* * *'
  id: totrans-95
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '* * *'
- en: ''
  id: totrans-96
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](../Images/7a39b9965926fb27c901966fb3fd3b9e.png)'
  id: totrans-97
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](../Images/7a39b9965926fb27c901966fb3fd3b9e.png)'
- en: ''
  id: totrans-98
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| Figure 13.2: Hazard function for age at first marriage (top) and survival
    curve (bottom). |'
  id: totrans-99
  prefs:
  - PREF_BQ
  type: TYPE_TB
  zh: '| 图13.2：首次婚姻年龄的危险函数（顶部）和生存曲线（底部）。 |'
- en: ''
  id: totrans-100
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-101
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '* * *'
- en: Figure [13.2](#survival2) (bottom) shows the result. The survival curve is steepest
    between 25 and 35, when most women get married. Between 35 and 45, the curve is
    nearly flat, indicating that women who do not marry before age 35 are unlikely
    to get married.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 图[13.2](#survival2)（底部）显示了结果。生存曲线在25岁到35岁之间最陡，这时大多数女性结婚。35岁到45岁之间，曲线几乎是平的，表明在35岁之前没有结婚的女性不太可能结婚。
- en: A curve like this was the basis of a famous magazine article in 1986; Newsweek
    reported that a 40-year old unmarried woman was “more likely to be killed by a
    terrorist” than get married. These statistics were widely reported and became
    part of popular culture, but they were wrong then (because they were based on
    faulty analysis) and turned out to be even more wrong (because of cultural changes
    that were already in progress and continued). In 2006, Newsweek ran an another
    article admitting that they were wrong.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 1986年，一篇著名的杂志文章以这样的曲线为基础；《新闻周刊》报道说，一个40岁未婚女性“更有可能被恐怖分子杀死”而不是结婚。这些统计数据被广泛报道，并成为流行文化的一部分，但当时是错误的（因为它们基于错误的分析），后来证明更加错误（因为已经在进行并持续的文化变革）。2006年，《新闻周刊》发表了另一篇文章承认他们错了。
- en: I encourage you to read more about this article, the statistics it was based
    on, and the reaction. It should remind you of the ethical obligation to perform
    statistical analysis with care, interpret the results with appropriate skepticism,
    and present them to the public accurately and honestly.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 我鼓励你阅读更多关于这篇文章、它所基于的统计数据以及反应的内容。这应该提醒你有道德义务以谨慎的态度进行统计分析，以适当的怀疑态度解释结果，并准确诚实地向公众呈现它们。
- en: 13.7  Confidence intervals
  id: totrans-105
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.7 置信区间
- en: 'Kaplan-Meier analysis yields a single estimate of the survival curve, but it
    is also important to quantify the uncertainty of the estimate. As usual, there
    are three possible sources of error: measurement error, sampling error, and modeling
    error.'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
- en: In this example, measurement error is probably small. People generally know
    when they were born, whether they’ve been married, and when. And they can be expected
    to report this information accurately.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
- en: 'We can quantify sampling error by resampling. Here’s the code:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '`ResampleSurvival` takes `resp`, a DataFrame of respondents, and `iters`, the
    number of times to resample. It computes `ts`, which is the sequence of ages where
    we will evaluate the survival curves.'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
- en: 'Inside the loop, `ResampleSurvival`:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: Resamples the respondents using `ResampleRowsWeighted`, which we saw in Section [10.7](thinkstats2011.html#weighted).
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Calls `EstimateSurvival`, which uses the process in the previous sections to
    estimate the hazard and survival curves, and
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Evaluates the survival curve at each age in `ts`.
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`ss_seq` is a sequence of evaluated survival curves. `PercentileRows` takes
    this sequence and computes the 5th and 95th percentiles, returning a 90% confidence
    interval for the survival curve.'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-116
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  id: totrans-117
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](../Images/92878845eb42d820b753106a008dd5c1.png)'
  id: totrans-118
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: ''
  id: totrans-119
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| Figure 13.3: Survival curve for age at first marriage (dark line) and a 90%
    confidence interval based on weighted resampling (gray line). |'
  id: totrans-120
  prefs:
  - PREF_BQ
  type: TYPE_TB
- en: ''
  id: totrans-121
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-122
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Figure [13.3](#survival3) shows the result along with the survival curve we
    estimated in the previous section. The confidence interval takes into account
    the sampling weights, unlike the estimated curve. The discrepancy between them
    indicates that the sampling weights have a substantial effect on the estimate—we
    will have to keep that in mind.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: 13.8  Cohort effects
  id: totrans-124
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: One of the challenges of survival analysis is that different parts of the estimated
    curve are based on different groups of respondents. The part of the curve at time
    `t` is based on respondents whose age was at least `t` when they were interviewed.
    So the leftmost part of the curve includes data from all respondents, but the
    rightmost part includes only the oldest respondents.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
- en: If the relevant characteristics of the respondents are not changing over time,
    that’s fine, but in this case it seems likely that marriage patterns are different
    for women born in different generations. We can investigate this effect by grouping
    respondents according to their decade of birth. Groups like this, defined by date
    of birth or similar events, are called cohorts, and differences between the groups
    are called cohort effects.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
- en: To investigate cohort effects in the NSFG marriage data, I gathered the Cycle
    6 data from 2002 used throughout this book; the Cycle 7 data from 2006–2010 used
    in Section [9.11](thinkstats2010.html#replication); and the Cycle 5 data from
    1995\. In total these datasets include 30,769 respondents.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'For each DataFrame, `resp`, I use `cmbirth` to compute the decade of birth
    for each respondent:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '`cmbirth` is encoded as the integer number of months since December 1899; `month0`
    represents that date as a Timestamp object. For each birth date, we instantiate
    a `DateOffset` that contains the century-month and add it to `month0`; the result
    is a sequence of Timestamps, which is converted to a `DateTimeIndex`. Finally,
    we extract `year` and compute decades.'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
- en: 'To take into account the sampling weights, and also to show variability due
    to sampling error, I resample the data, group respondents by decade, and plot
    survival curves:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Data from the three NSFG cycles use different sampling weights, so I resample
    them separately and then use `concat` to merge them into a single DataFrame. The
    parameter `ignore_index` tells `concat` not to match up respondents by index;
    instead it creates a new index from 0 to 30768.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
- en: '`EstimateSurvivalByDecade` plots survival curves for each cohort:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '* * *'
  id: totrans-137
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  id: totrans-138
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](../Images/3b27a833c0d7ebce0e83f5d13a54d9ce.png)'
  id: totrans-139
  prefs:
  - PREF_BQ
  type: TYPE_IMG
- en: ''
  id: totrans-140
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| Figure 13.4: Survival curves for respondents born during different decades.
    |'
  id: totrans-141
  prefs:
  - PREF_BQ
  type: TYPE_TB
  zh: '| 图13.4：不同年代出生的受访者的生存曲线。 |'
- en: ''
  id: totrans-142
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-143
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '* * *'
- en: 'Figure [13.4](#survival4) shows the results. Several patterns are visible:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.4显示了结果。有几种模式是可见的：
- en: Women born in the 50s married earliest, with successive cohorts marrying later
    and later, at least until age 30 or so.
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 60年代出生的女性最早结婚，随后的队列结婚的时间越来越晚，至少在30岁左右。
- en: Women born in the 60s follow a surprising pattern. Prior to age 25, they were
    marrying at slower rates than their predecessors. After age 25, they were marrying
    faster. By age 32 they had overtaken the 50s cohort, and at age 44 they are substantially
    more likely to have married.
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 60年代出生的女性遵循了一个令人惊讶的模式。25岁之前，她们的结婚速度比她们的前辈慢。25岁之后，她们的结婚速度加快了。到32岁时，她们已经超过了50年代的队列，44岁时她们结婚的可能性要大得多。
- en: Women born in the 60s turned 25 between 1985 and 1995\. Remembering that the
    Newsweek article I mentioned was published in 1986, it is tempting to imagine
    that the article triggered a marriage boom. That explanation would be too pat,
    but it is possible that the article and the reaction to it were indicative of
    a mood that affected the behavior of this cohort.
  id: totrans-147
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 60年代出生的女性在1985年至1995年之间年满25岁。记得我提到的《Newsweek》文章是在1986年发表的，很诱人地想象这篇文章引发了一场结婚热潮。这种解释可能太过简单，但有可能这篇文章及其引起的反应反映了影响这一队行为的情绪。
- en: The pattern of the 70s cohort is similar. They are less likely than their predecessors
    to be married before age 25, but at age 35 they have caught up with both of the
    previous cohorts.
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 70年代队列的模式类似。他们在25岁之前结婚的可能性比前辈小，但到35岁时，他们已经赶上了前两队。
- en: Women born in the 80s are even less likely to marry before age 25\. What happens
    after that is not clear; for more data, we have to wait for the next cycle of
    the NSFG.
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 80年代出生的女性在25岁之前结婚的可能性甚至更小。之后会发生什么并不清楚；要获得更多数据，我们必须等待下一轮 NSFG 的数据。
- en: In the meantime we can make some predictions.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 与此同时，我们可以做一些预测。
- en: 13.9  Extrapolation
  id: totrans-151
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.9 推断
- en: The survival curve for the 70s cohort ends at about age 38; for the 80s cohort
    it ends at age 28, and for the 90s cohort we hardly have any data at all.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 70年代队列的生存曲线在大约38岁结束；80年代队列在28岁结束，90年代队列我们几乎没有任何数据。
- en: 'We can extrapolate these curves by “borrowing” data from the previous cohort.
    HazardFunction provides a method, `Extend`, that copies the tail from another
    longer HazardFunction:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过“借用”上一队的数据来推断这些曲线。HazardFunction 提供了一个名为 `Extend` 的方法，它可以从另一个更长的 HazardFunction
    中复制尾部：
- en: '[PRE20]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: As we saw in Section [13.2](#hazard), the HazardFunction contains a Series that
    maps from t to λ(t). `Extend` finds `last`, which is the last index in `self.series`,
    selects values from `other` that come later than `last`, and appends them onto
    `self.series`.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在第13.2节中看到的，HazardFunction 包含了一个从 t 到 λ(t) 的 Series。`Extend` 找到了 `last`，它是
    `self.series` 中的最后一个索引，然后从 `other` 中选择比 `last` 更晚的值，并将它们附加到 `self.series` 上。
- en: 'Now we can extend the HazardFunction for each cohort, using values from the
    predecessor:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以扩展每个队列的 HazardFunction，使用前任的值：
- en: '[PRE21]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '`groups` is a GroupBy object with respondents grouped by decade of birth. The
    first loop computes the HazardFunction for each group.'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '`groups` 是一个按出生年代分组的 GroupBy 对象。第一个循环计算了每个组的 HazardFunction。'
- en: The second loop extends each HazardFunction with values from its predecessor,
    which might contain values from the previous group, and so on. Then it converts
    each HazardFunction to a SurvivalFunction and plots it.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个循环将每个 HazardFunction 扩展到其前任的值，这些值可能包含来自上一组的值，依此类推。然后将每个 HazardFunction 转换为
    SurvivalFunction 并绘制出来。
- en: '* * *'
  id: totrans-160
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '* * *'
- en: ''
  id: totrans-161
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](../Images/49c5cc772d8b7ffffa8e0a6142c96cd1.png)'
  id: totrans-162
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](../Images/49c5cc772d8b7ffffa8e0a6142c96cd1.png)'
- en: ''
  id: totrans-163
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| Figure 13.5: Survival curves for respondents born during different decades,
    with predictions for the later cohorts. |'
  id: totrans-164
  prefs:
  - PREF_BQ
  type: TYPE_TB
  zh: '| 图13.5：不同年代出生的受访者的生存曲线，以及对后续队列的预测。 |'
- en: ''
  id: totrans-165
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-166
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '* * *'
- en: Figure [13.5](#survival5) shows the results; I’ve removed the 50s cohort to
    make the predictions more visible. These results suggest that by age 40, the most
    recent cohorts will converge with the 60s cohort, with fewer than 20% never married.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 图13.5显示了结果；我已经移除了50年代队列，以使预测更加明显。这些结果表明，到40岁时，最近的队列将与60年代队列趋于一致，不到20%的人未婚。
- en: 13.10  Expected remaining lifetime
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.10 预期剩余寿命
- en: Given a survival curve, we can compute the expected remaining lifetime as a
    function of current age. For example, given the survival curve of pregnancy length
    from Section [13.1](#survival), we can compute the expected time until delivery.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 给定一个生存曲线，我们可以计算当前年龄的预期剩余寿命。例如，给定来自第13.1节的怀孕时长的生存曲线，我们可以计算预期的分娩时间。
- en: 'The first step is to extract the PMF of lifetimes. `SurvivalFunction` provides
    a method that does that:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是提取寿命的 PMF。`SurvivalFunction` 提供了一个可以做到这一点的方法：
- en: '[PRE22]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Remember that the SurvivalFunction contains the Cdf of lifetimes. The loop copies
    the values and probabilities from the Cdf into a Pmf.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，SurvivalFunction 包含了寿命的 Cdf。循环将这些值和概率从 Cdf 复制到 Pmf 中。
- en: '`cutoff` is the highest probability in the Cdf, which is 1 if the Cdf is complete,
    and otherwise less than 1. If the Cdf is incomplete, we plug in the provided value,
    `filler`, to cap it off.'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: '`cutoff` 是 Cdf 中最高的概率，如果 Cdf 完整，则为1，否则小于1。如果 Cdf 不完整，我们会插入提供的值 `filler` 来进行封顶。'
- en: The Cdf of pregnancy lengths is complete, so we don’t have to worry about this
    detail yet.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 怀孕时长的 Cdf 已经完整，所以我们不必担心这个细节。
- en: 'The next step is to compute the expected remaining lifetime, where “expected”
    means average. `SurvivalFunction` provides a method that does that, too:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是计算预期剩余寿命，这里的“预期”是指平均值。`SurvivalFunction` 也提供了一个可以做到这一点的方法：
- en: '[PRE23]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '`RemainingLifetime` takes `filler`, which is passed along to `MakePmf`, and
    `func` which is the function used to summarize the distribution of remaining lifetimes.'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: '`RemainingLifetime` 接受 `filler`，它会传递给 `MakePmf`，以及 `func`，它是用于总结剩余寿命分布的函数。'
- en: '`pmf` is the Pmf of lifetimes extracted from the SurvivalFunction. `d` is a
    dictionary that contains the results, a map from current age, `t`, to expected
    remaining lifetime.'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '`pmf`是从SurvivalFunction中提取的寿命的Pmf。`d`是一个包含结果的字典，从当前年龄`t`到预期剩余寿命的映射。'
- en: The loop iterates through the values in the Pmf. For each value of `t` it computes
    the conditional distribution of lifetimes, given that the lifetime exceeds `t`.
    It does that by removing values from the Pmf one at a time and renormalizing the
    remaining values.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 循环遍历Pmf中的值。对于每个`t`的值，它计算给定寿命超过`t`的条件分布。它通过逐个删除Pmf中的值并重新归一化剩余值来实现这一点。
- en: Then it uses `func` to summarize the conditional distribution. In this example
    the result is the mean pregnancy length, given that the length exceeds `t`. By
    subtracting `t` we get the mean remaining pregnancy length.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 然后它使用`func`来总结条件分布。在这个例子中，结果是给定长度超过`t`的情况下的平均怀孕时长。通过减去`t`，我们得到了平均剩余怀孕时长。
- en: '* * *'
  id: totrans-181
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '* * *'
- en: ''
  id: totrans-182
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](../Images/3f058a0b02cf7630155cbfd229586e79.png)'
  id: totrans-183
  prefs:
  - PREF_BQ
  type: TYPE_IMG
  zh: '![](../Images/3f058a0b02cf7630155cbfd229586e79.png)'
- en: ''
  id: totrans-184
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '| Figure 13.6: Expected remaining pregnancy length (left) and years until first
    marriage (right). |'
  id: totrans-185
  prefs:
  - PREF_BQ
  type: TYPE_TB
  zh: '| 图13.6：预期剩余怀孕时长（左）和首次婚姻年龄（右）。|'
- en: ''
  id: totrans-186
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-187
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '* * *'
- en: Figure [13.6](#survival6) (left) shows the expected remaining pregnancy length
    as a function of the current duration. For example, during Week 0, the expected
    remaining duration is about 34 weeks. That’s less than full term (39 weeks) because
    terminations of pregnancy in the first trimester bring the average down.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 图[13.6](#survival6)（左）显示了预期剩余怀孕时长与当前持续时间的函数关系。例如，在第0周，预期剩余时间约为34周。这比满期（39周）少，因为在第一季度终止怀孕会使平均值降低。
- en: The curve drops slowly during the first trimester. After 13 weeks, the expected
    remaining lifetime has dropped by only 9 weeks, to 25\. After that the curve drops
    faster, by about a week per week.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 曲线在第一季度缓慢下降。13周后，预期寿命仅下降了9周，为25周。之后曲线下降速度加快，每周大约下降一周。
- en: 'Between Week 37 and 42, the curve levels off between 1 and 2 weeks. At any
    time during this period, the expected remaining lifetime is the same; with each
    week that passes, the destination gets no closer. Processes with this property
    are called memoryless because the past has no effect on the predictions. This
    behavior is the mathematical basis of the infuriating mantra of obstetrics nurses:
    “any day now.”'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 在第37周和42周之间，曲线在1到2周之间水平。在此期间的任何时候，预期剩余寿命都是相同的；随着每周的过去，目的地并没有更近。具有这种特性的过程被称为无记忆，因为过去对预测没有影响。这种行为是产科护士令人恼火的口头禅“任何一天都有可能”背后的数学基础。
- en: 'Figure [13.6](#survival6) (right) shows the median remaining time until first
    marriage, as a function of age. For an 11 year-old girl, the median time until
    first marriage is about 14 years. The curve decreases until age 22 when the median
    remaining time is about 7 years. After that it increases again: by age 30 it is
    back where it started, at 14 years.'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 图[13.6](#survival6)（右）显示了年龄的中位数剩余时间直到首次婚姻。对于一个11岁的女孩，首次婚姻的中位时间约为14年。曲线下降直到22岁时，中位剩余时间约为7年。之后又增加：到30岁时又回到了14年。
- en: Based on this data, young women have decreasing remaining “lifetimes”. Mechanical
    components with this property are called NBUE for “new better than used in expectation,”
    meaning that a new part is expected to last longer.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 根据这些数据，年轻女性的剩余“寿命”在减少。具有这种特性的机械部件被称为NBUE，“在期望中新的比使用的更好”，这意味着新部件预期寿命更长。
- en: Women older than 22 have increasing remaining time until first marriage. Components
    with this property are called UBNE for “used better than new in expectation.”
    That is, the older the part, the longer it is expected to last. Newborns and cancer
    patients are also UBNE; their life expectancy increases the longer they live.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 22岁以上的女性剩余时间直到首次婚姻增加。具有这种特性的组件被称为UBNE，“在期望中比新的更好使用”。也就是说，部件越老，预期寿命越长。新生儿和癌症患者也是UBNE；他们的预期寿命随着他们的生活时间增加而增加。
- en: For this example I computed median, rather than mean, because the Cdf is incomplete;
    the survival curve projects that about 20% of respondents will not marry before
    age 44\. The age of first marriage for these women is unknown, and might be non-existent,
    so we can’t compute a mean.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我计算了中位数，而不是平均数，因为Cdf是不完整的；生存曲线预测大约20%的受访者在44岁之前不会结婚。这些女性的首次婚姻年龄是未知的，可能不存在，因此我们无法计算平均值。
- en: I deal with these unknown values by replacing them with `np.inf`, a special
    value that represents infinity. That makes the mean infinity for all ages, but
    the median is well-defined as long as more than 50% of the remaining lifetimes
    are finite, which is true until age 30\. After that it is hard to define a meaningful
    expected remaining lifetime.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 我通过用`np.inf`替换这些未知值来处理它们，`np.inf`是表示无穷大的特殊值。这使得所有年龄的平均值都是无穷大，但只要超过50%的剩余寿命是有限的，中位数就是明确定义的，这在30岁之前是正确的。之后很难定义有意义的预期剩余寿命。
- en: 'Here’s the code that computes and plots these functions:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 这是计算和绘制这些函数的代码：
- en: '[PRE24]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '`sf1` is the survival curve for pregnancy length; in this case we can use the
    default values for `RemainingLifetime`.'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: '`sf1`是怀孕时长的生存曲线；在这种情况下，我们可以使用`RemainingLifetime`的默认值。'
- en: '`sf2` is the survival curve for age at first marriage; `func` is a function
    that takes a Pmf and computes its median (50th percentile).'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: '`sf2`是首次婚姻年龄的生存曲线；`func`是一个接受Pmf并计算其中位数（第50百分位数）的函数。'
- en: 13.11  Exercises
  id: totrans-200
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.11 练习
- en: My solution to this exercise is in `chap13soln.py`.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 我对这个练习的解决方案在`chap13soln.py`中。
- en: Exercise 1   *In NSFG Cycles 6 and 7, the variable `cmdivorcx` contains the
    date of divorce for the respondent’s first marriage, if applicable, encoded in
    century-months.*
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 练习1 *在NSFG循环6和7中，变量`cmdivorcx`包含了受访者第一次婚姻的离婚日期（如果适用），以世纪-月份编码。*
- en: '*Compute the duration of marriages that have ended in divorce, and the duration,
    so far, of marriages that are ongoing. Estimate the hazard and survival curve
    for the duration of marriage.*'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: '*计算已经离婚的婚姻的持续时间，以及目前正在进行的婚姻的持续时间。估计婚姻持续时间的危险和生存曲线。*'
- en: '*Use resampling to take into account sampling weights, and plot data from several
    resamples to visualize sampling error.*'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: '*使用重采样来考虑抽样权重，并绘制来自多个重采样的数据以可视化抽样误差。*'
- en: '*Consider dividing the respondents into groups by decade of birth, and possibly
    by age at first marriage.*'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: '*考虑按出生年代和可能的初婚年龄将受访者分成几组。*'
- en: 13.12  Glossary
  id: totrans-206
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 13.12 术语表
- en: 'survival analysis: A set of methods for describing and predicting lifetimes,
    or more generally time until an event occurs.'
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 生存分析：一组用于描述和预测寿命，或更一般地，直到事件发生的时间的方法。
- en: 'survival curve: A function that maps from a time, t, to the probability of
    surviving past t.'
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 生存曲线：将时间t映射到超过t的生存概率的函数。
- en: 'hazard function: A function that maps from t to the fraction of people alive
    until t who die at t.'
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 危险函数：将t映射到在t时死亡的活着的人的比例的函数。
- en: 'Kaplan-Meier estimation: An algorithm for estimating hazard and survival functions.'
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kaplan-Meier估计：用于估计危险和生存函数的算法。
- en: 'cohort: a group of subjects defined by an event, like date of birth, in a particular
    interval of time.'
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 队列：由事件（如出生日期）定义的一组受试者，在特定时间间隔内。
- en: 'cohort effect: a difference between cohorts.'
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 队列效应：队列之间的差异。
- en: 'NBUE: A property of expected remaining lifetime, “New better than used in expectation.”'
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: NBUE：预期剩余寿命的属性，“期望中比使用的更好。”
- en: 'UBNE: A property of expected remaining lifetime, “Used better than new in expectation.”'
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: UBNE：预期剩余寿命的属性，“期望中比新的更好。”

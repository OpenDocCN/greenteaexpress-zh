- en: Regression
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://allendowney.github.io/ElementsOfDataScience/10_regression.html](https://allendowney.github.io/ElementsOfDataScience/10_regression.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[Click here to run this notebook on Colab](https://colab.research.google.com/github/AllenDowney/ElementsOfDataScience/blob/master/10_regression.ipynb)
    or [click here to download it](https://github.com/AllenDowney/ElementsOfDataScience/raw/master/10_regression.ipynb).'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: In the previous chapter we used simple linear regression to quantify the relationship
    between two variables. In this chapter we’ll get farther into regression, including
    multiple regression and one of my all-time favorite tools, logistic regression.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: These tools will allow us to explore relationships among sets of variables.
    As an example, we will use data from the General Social Survey (GSS) to explore
    the relationship between income, education, age, and sex. But first let’s understand
    the limits of simple regression.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: Limits of Simple Regression
  id: totrans-5
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In a previous exercise, you made a scatter plot of vegetable consumption as
    a function of income, and plotted a line of best fit. Here’s what it looks like:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/87d9d2b0287e9053ae7755d9809f8756.png)'
  id: totrans-7
  prefs: []
  type: TYPE_IMG
- en: The slope of the line is 0.07, which means that the difference between the lowest
    and highest income brackets is about 0.49 servings per day. So that’s not a very
    big difference.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: But it was an arbitrary choice to plot vegetables as a function of income. We
    could have plotted it the other way around, like this.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/6c47c5ecca914eda960557904adc81f5.png)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
- en: The slope of this line is about 0.2, which means that the difference between
    0 and 10 servings per day is about 2 income levels, roughly from level 5 to level
    7.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: And the difference between income levels 5 and 7 is about $30,000 per year,
    which is substantial.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: So if we use vegetable consumption to predict income, we see a big difference.
    But when we used income to predict vegetable consumption, we saw a small difference.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: This example shows that regression is not symmetric; the regression of A onto
    B is not the same as the regression of B onto A.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: We can see that more clearly by putting the two figures side by side and plotting
    both regression lines on both figures.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
- en: '![](../Images/cee1b89025f8abd15455316ed120bb5a.png)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
- en: They are different because they are based on different assumptions.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: On the left, we treat income as a known quantity and vegetable consumption as
    random.
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: On the right, we treat vegetable consumption as known and income as random.
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: When you run a regression model, you make decisions about how to treat the data,
    and those decisions affect the results you get.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: This example demonstrates another point, which is that regression doesn’t tell
    you much about causation.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: If you think people with lower income can’t afford vegetables, you might look
    at the figure on the left and conclude that it doesn’t make much difference.
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you think better diet increases income, the figure on the right might make
    you think it does.
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: But in general, regression can’t tell you what causes what. If you see a relationship
    between any two variables, A and B, the reason for the relationship might be that
    A causes B, or B causes A, or there might be other factors that cause both A and
    B. Regression alone can’t tell you which way it goes.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: However, we have tools for quantifying relationships among multiple variables;
    one of the most important is multiple regression.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: Regression with StatsModels
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: SciPy doesn’t do multiple regression, so we’ll to switch to a new library, StatsModels.
    Here’s the import statement.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: For the first example, we’ll load data from the Behavioral Risk Factor Surveillance
    Survey (BRFSS), which we saw in the previous chapter.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Now we can use StatsModels to fit a regression model. We’ll start with one of
    the examples from the previous chapter, the relationship between income and vegetable
    consumption. We’ll check that the results from StatsModels are the same as the
    results from SciPy. Then we’ll move on to multiple regression.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以使用StatsModels来拟合一个回归模型。我们将从上一章的示例之一开始，即收入和蔬菜消费之间的关系。我们将检查StatsModels的结果是否与SciPy的结果相同。然后我们将继续进行多元回归。
- en: The function we’ll use is `ols`, which stands for “ordinary least squares”,
    another name for regression.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用的函数是`ols`，它代表“普通最小二乘法”，这是回归的另一个名称。
- en: '[PRE2]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The first argument is a **formula string** that specifies that we want to regress
    income as a function of vegetable consumption. The second argument is the BRFSS
    `DataFrame`. The names in the formula string correspond to columns in the `DataFrame`.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个参数是一个**公式字符串**，指定我们要将收入回归为蔬菜消费的函数。第二个参数是BRFSS的`DataFrame`。公式字符串中的名称对应于`DataFrame`中的列。
- en: The result from `ols` is an object that represents the model; it provides a
    function called `fit` that does the actual computation.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '`ols`的结果是一个代表模型的对象；它提供了一个名为`fit`的函数，用于进行实际计算。'
- en: The result is a `RegressionResultsWrapper`, which contains several attributes;
    the first one we’ll look at is `params`, which contains the estimated intercept
    and the slope associated with `_VEGESU1`.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是一个“RegressionResultsWrapper”，其中包含几个属性；我们将首先查看的是“params”，其中包含与“_VEGESU1”相关的估计截距和斜率。
- en: '[PRE3]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '[PRE4]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The results from Statsmodels are the same as the results we got from SciPy,
    so that’s good!
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: Statsmodels的结果与我们从SciPy得到的结果相同，这很好！
- en: There are only two variables in this example, so it is still simple regression.
    In the next section we’ll move on to multiple regression. But first, some exercises.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中只有两个变量，所以它仍然是简单回归。在下一节中，我们将继续进行多元回归。但首先，一些练习。
- en: '**Exercise:** In the BRFSS dataset, there is a strong relationship between
    vegetable consumption and income. The income of people who eat 8 servings of vegetables
    per day is double the income of people who eat none, on average.'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习：** 在BRFSS数据集中，蔬菜消费与收入之间存在着很强的关系。每天食用8份蔬菜的人的收入平均是不吃蔬菜的人的两倍。'
- en: Which of the following conclusions can we draw from this data?
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: '我们可以从这些数据中得出以下哪些结论？ '
- en: A. Eating a good diet leads to better health and higher income.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: A. 饮食良好会导致更好的健康和更高的收入。
- en: B. People with higher income can afford a better diet.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: B. 收入较高的人能够负担更好的饮食。
- en: C. People with high income are more likely to be vegetarians.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: C. 收入较高的人更有可能是素食主义者。
- en: '**Exercise:** Let’s run a regression using SciPy and StatsModels, and confirm
    we get the same results.'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习：** 让我们使用SciPy和StatsModels来运行回归，并确认我们得到相同的结果。'
- en: Compute the regression of `_VEGESU1` as a function of `INCOME2` using SciPy’s
    `linregress()`.
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用SciPy的`linregress()`计算`INCOME2`的函数作为`_VEGESU1`的回归。
- en: Compute the regression of `_VEGESU1` as a function of `INCOME2` using StatsModels’
    `smf.ols()`.
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用StatsModels的`smf.ols()`计算`INCOME2`的函数作为`_VEGESU1`的回归。
- en: 'Note: `linregress` does not handle `NaN` values, so you will have to use `dropna`
    to select the rows with valid data.'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：`linregress`不能处理`NaN`值，因此您将需要使用`dropna`来选择具有有效数据的行。
- en: Multiple Regression
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 多元回归
- en: Now that we have StatsModels, getting from simple to multiple regression is
    easy. As an example, we’ll use data from the General Social Survey (GSS) and we’ll
    explore variables that are related to income.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了StatsModels，从简单到多元回归变得容易。作为示例，我们将使用来自普通社会调查（GSS）的数据，探索与收入相关的变量。
- en: First, let’s load the GSS data.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们加载GSS数据。
- en: '[PRE5]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Here are the first few rows of `gss`:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 这是`gss`的前几行：
- en: '[PRE6]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '|  | YEAR | ID_ | AGE | EDUC | SEX | GUNLAW | GRASS | REALINC |'
  id: totrans-56
  prefs: []
  type: TYPE_TB
  zh: '|  | 年份 | ID_ | 年龄 | 教育 | 性别 | 枪支法 | 大麻 | 真实收入 |'
- en: '| --- | --- | --- | --- | --- | --- | --- | --- | --- |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- | --- | --- | --- | --- |'
- en: '| 0 | 1972 | 1 | 23.0 | 16.0 | 2 | 1.0 | NaN | 18951.0 |'
  id: totrans-58
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 1972 | 1 | 23.0 | 16.0 | 2 | 1.0 | NaN | 18951.0 |'
- en: '| 1 | 1972 | 2 | 70.0 | 10.0 | 1 | 1.0 | NaN | 24366.0 |'
  id: totrans-59
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 1972 | 2 | 70.0 | 10.0 | 1 | 1.0 | NaN | 24366.0 |'
- en: '| 2 | 1972 | 3 | 48.0 | 12.0 | 2 | 1.0 | NaN | 24366.0 |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 1972 | 3 | 48.0 | 12.0 | 2 | 1.0 | NaN | 24366.0 |'
- en: '| 3 | 1972 | 4 | 27.0 | 17.0 | 2 | 1.0 | NaN | 30458.0 |'
  id: totrans-61
  prefs: []
  type: TYPE_TB
  zh: '| 3 | 1972 | 4 | 27.0 | 17.0 | 2 | 1.0 | NaN | 30458.0 |'
- en: '| 4 | 1972 | 5 | 61.0 | 12.0 | 2 | 1.0 | NaN | 50763.0 |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
  zh: '| 4 | 1972 | 5 | 61.0 | 12.0 | 2 | 1.0 | NaN | 50763.0 |'
- en: We’ll start with another simple regression, estimating the parameters of real
    income as a function of years of education.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从另一个简单回归开始，估计真实收入的参数作为教育年限的函数。
- en: '[PRE7]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '[PRE8]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: On the left side of the formula string, `REALINC` is the variable we are trying
    to predict; on the right, `EDUC` is the variable we are using to inform the predictions.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在公式字符串的左侧，“REALINC”是我们试图预测的变量；在右侧，“EDUC”是我们用来预测的变量。
- en: 'The estimated slope is about `3450`, which means that each additional year
    of education is associated with an additional $3450 of income. But income also
    depends on age, so it would be good to include that in the model, too. Here’s
    how:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 估计的斜率约为`3450`，这意味着每多一年的教育与额外的3450美元的收入相关联。但收入也取决于年龄，因此也应该将其包括在模型中。这是如何做的：
- en: '[PRE9]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '[PRE10]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: On the right side of the formula string, you can list as many variables as you
    like, in this case, education and age. The `plus` sign indicates that we expect
    the contributions of the two variables to be additive, which is a common assumption
    for models like this.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在公式字符串的右侧，您可以列出尽可能多的变量，例如教育和年龄。`plus`符号表示我们期望这两个变量的贡献是相加的，这是这种模型的常见假设。
- en: The estimated slope for `EDUC` is a little less than what we saw before, about
    $3514 per year.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '`EDUC`的估计斜率比我们之前看到的要小一点，大约每年3514美元。'
- en: The estimated slope for `AGE` is only about $54 per year, which is surprisingly
    small.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '`AGE`的估计斜率只有大约每年54美元，这是令人惊讶的小。'
- en: Grouping by Age
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 按年龄分组
- en: To see what’s going on, let’s look more closely at the relationship between
    income and age. We’ll use a Pandas method we have not seen before, called `groupby`,
    to divide the `DataFrame` into age groups.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解情况，让我们更仔细地看一下收入和年龄之间的关系。我们将使用一个我们以前没有见过的Pandas方法，称为“groupby”，将“DataFrame”分成年龄组。
- en: '[PRE11]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '[PRE12]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The result is a `GroupBy` object that contains one group for each value of `age`.
    The `GroupBy` object behaves like a `DataFrame` in many ways. You can use brackets
    to select a column, like `REALINC` in this example, and then invoke a method like
    `mean`.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是一个“GroupBy”对象，它包含每个年龄值的一个组。在许多方面，“GroupBy”对象的行为类似于“DataFrame”。你可以使用方括号选择一个列，比如这个例子中的“REALINC”，然后调用一个方法，比如“mean”。
- en: '[PRE13]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The result is a Pandas `Series` that contains the mean income for each age group,
    which we can plot like this.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是一个包含每个年龄组平均收入的Pandas“Series”，我们可以像这样绘制它。
- en: '[PRE14]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![_images/10_regression_38_0.png](../Images/3d9e6bb1d0505e2b65de9033c01a9819.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![_images/10_regression_38_0.png](../Images/3d9e6bb1d0505e2b65de9033c01a9819.png)'
- en: Average income increases from age 20 to age 50, then starts to fall.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 平均收入从20岁增加到50岁，然后开始下降。
- en: And that explains why the estimated slope is so small, because the relationship
    is non-linear. Remember that correlation and simple regression can’t measure non-linear
    relationships.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 这就解释了为什么估计的斜率如此之小，因为关系是非线性的。记住，相关性和简单回归无法衡量非线性关系。
- en: But multiple regression can! To describe a non-linear relationship, one option
    is to add a new variable that is a non-linear combination of other variables.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 但多元回归可以！为了描述非线性关系，一个选择是添加一个新变量，它是其他变量的非线性组合。
- en: As an example, we’ll create a new variable called `AGE2` that equals `AGE` squared.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我们将创建一个名为“AGE2”的新变量，它等于“AGE”的平方。
- en: '[PRE15]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Now we can run a regression with both `age` and `age2` on the right side.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以对右侧同时运行“age”和“age2”的回归。
- en: '[PRE16]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '[PRE17]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: In this model, the slope associated with `AGE` is substantial, about $1760 per
    year.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个模型中，与“AGE”相关的斜率很大，大约每年1760美元。
- en: The slope associated with `AGE2` is about -$17, but that’s harder to interpret.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 与“AGE2”相关的斜率约为-17美元，但这更难解释。
- en: In the next section, we’ll see methods to interpret multivariate models and
    visualize the results. But first, here are two exercises where you can practice
    using `groupby` and `ols`.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将看到解释多元模型和可视化结果的方法。但首先，这里有两个练习，你可以练习使用“groupby”和“ols”。
- en: '**Exercise:** To get a closer look at the relationship between income and education,
    let’s use the variable `EDUC` to group the data, then plot mean income in each
    group.'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习：**为了更仔细地观察收入和教育之间的关系，让我们使用变量“EDUC”对数据进行分组，然后绘制每个组的平均收入。'
- en: Group `gss` by `EDUC`.
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 按“EDUC”对“gss”进行分组。
- en: From the resulting `GroupBy` object, extract `REALINC` and compute the mean.
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从结果的“GroupBy”对象中提取“REALINC”并计算平均值。
- en: Plot mean income in each education group as a scatter plot.
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将每个教育组的平均收入作为散点图绘制。
- en: What can you say about the relationship between education and income? Does it
    look like a linear relationship?
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 关于教育和收入之间的关系，你能说些什么？看起来像是线性关系吗？
- en: '**Exercise:** The graph in the previous exercise suggests that the relationship
    between income and education is non-linear. So let’s try fitting a non-linear
    model.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习：**上一个练习中的图表表明收入和教育之间的关系是非线性的。所以让我们尝试拟合一个非线性模型。'
- en: Add a column named `EDUC2` to the `gss` DataFrame; it should contain the values
    from `EDUC` squared.
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在“gss”DataFrame中添加一个名为“EDUC2”的列；它应该包含“EDUC”的平方值。
- en: Run a regression model that uses `EDUC`, `EDUC2`, `age`, and `age2` to predict
    `REALINC`.
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行一个回归模型，使用“EDUC”、“EDUC2”、“age”和“age2”来预测“REALINC”。
- en: Visualizing regression results
  id: totrans-101
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 可视化回归结果
- en: In the previous section we ran a multiple regression model to characterize the
    relationships between income, age, and education. Because the model includes quadratic
    terms, the parameters are hard to interpret. For example, you might notice that
    the parameter for `EDUC` is negative, and that might be a surprise, because it
    suggests that higher education is associated with lower income.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一节中，我们运行了一个多元回归模型来描述收入、年龄和教育之间的关系。因为模型包括二次项，参数很难解释。例如，你可能会注意到“EDUC”的参数是负的，这可能会让人感到惊讶，因为它表明更高的教育与较低的收入相关联。
- en: But the parameter for `EDUC2` is positive, and that makes a big difference.
    In this section we’ll see a way to interpret the model visually and validate it
    against data.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 但“EDUC2”的参数是正的，这会产生很大的差异。在本节中，我们将看到一种通过数据视觉化解释模型并验证模型的方法。
- en: Here’s the model from the previous exercise.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 这是上一个练习中的模型。
- en: '[PRE18]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '[PRE19]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Sometimes we can understand a model by looking at its parameters, but often
    it is better to look at its predictions.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 有时我们可以通过查看模型的参数来理解模型，但通常最好查看其预测。
- en: The regression results provide a method called `predict` that uses the model
    to generate predictions. It takes a `DataFrame` as a parameter and returns a `Series`
    with a prediction for each row in the `DataFrame`. To use it, we’ll create a new
    `DataFrame` with `AGE` running from 18 to 89, and `AGE2` set to `AGE` squared.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 回归结果提供了一个名为“predict”的方法，它使用模型生成预测。它以一个“DataFrame”作为参数，并返回一个包含“DataFrame”中每一行预测的“Series”。为了使用它，我们将创建一个新的“DataFrame”，其中“AGE”从18到89，而“AGE2”设置为“AGE”的平方。
- en: '[PRE20]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Next, we’ll pick a level for `EDUC`, like 12 years, which is the most common
    value. When you assign a single value to a column in a `DataFrame`, Pandas makes
    a copy for each row.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将选择一个“EDUC”的水平，比如12年，这是最常见的值。当你给“DataFrame”的一列分配一个单个值时，Pandas会为每一行创建一个副本。
- en: '[PRE21]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Then we can use `results` to predict the average income for each age group,
    holding education constant.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们可以使用“results”来预测每个年龄组的平均收入，保持教育水平不变。
- en: '[PRE22]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: The result from `predict` is a `Series` with one prediction for each row. So
    we can plot it with age on the \(x\)-axis and the predicted income for each age
    group on the \(y\)-axis. And we can plot the data for comparison.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: “predict”的结果是一个包含每一行预测的“Series”。因此，我们可以将其与年龄作为\(x\)-轴和每个年龄组的预测收入作为\(y\)-轴进行绘制。我们可以绘制数据进行比较。
- en: '[PRE23]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '![_images/10_regression_57_0.png](../Images/b9b16ddf823f1a93bc564c106d4dd17e.png)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
- en: The dots show the average income in each age group. The line shows the predictions
    generated by the model, holding education constant. This plot shows the shape
    of the model, a downward-facing parabola.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
- en: We can do the same thing with other levels of education, like 14 years, which
    is the nominal time to earn an Associate’s degree, and 16 years, which is the
    nominal time to earn a Bachelor’s degree.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '[PRE25]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '![_images/10_regression_60_0.png](../Images/89166cad7bdbadc5743465639c3577ac.png)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
- en: The lines show mean income, as predicted by the model, as a function of age,
    for three levels of education. This visualization helps validate the model, since
    we can compare the predictions with the data. And it helps us interpret the model
    since we can see the separate contributions of age and education.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
- en: In the exercises, you’ll have a chance to run a multiple regression, generate
    predictions, and visualize the results.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: '**Exercise:** At this point, we have a model that predicts income using age,
    education, and sex.'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
- en: Let’s see what it predicts for different levels of education, holding `AGE`
    constant.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
- en: Create an empty `DataFrame` named `df`.
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using `np.linspace()`, add a variable named `EDUC` to `df` with a range of values
    from `0` to `20`.
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Add a variable named `AGE` with the constant value `30`.
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use `df` to generate predicted income as a function of education.
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Exercise:** Now let’s visualize the results from the previous exercise!'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
- en: Group the GSS data by `EDUC` and compute the mean income in each education group.
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Plot mean income for each education group as a scatter plot.
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Plot the predictions from the previous exercise.
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How do the predictions compare with the data?
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
- en: '**Optional Exercise:** Extend the previous exercise to include predictions
    for a few other age levels.'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
- en: Categorical Variables
  id: totrans-136
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Most of the variables we have used so far — like income, age, and education
    — are numerical. But variables like sex and race are **categorical**; that is,
    each respondent belongs to one of a specified set of categories. If there are
    only two categories, we would say the variable is **binary**.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
- en: 'With StatsModels, it is easy to include a categorical variable as part of a
    regression model. Here’s an example:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE26]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '[PRE27]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: In the formula string, the letter `C` indicates that `SEX` is a categorical
    variable.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
- en: The regression treats the value `SEX=1`, which is male, as the default, and
    reports the difference associated with the value `SEX=2`, which is female. So
    this result indicates that income for women is about $4156 less than for men,
    after controlling for age and education.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
- en: Logistic Regression
  id: totrans-143
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In the previous section, we added a categorical variables on the right side
    of a regression formula; that is, we used it as a predictive variables.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
- en: But what if the categorical variable is on the left side of the regression formula;
    that is, it’s the value we are trying to predict? In that case, we can use **logistic
    regression**.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: As an example, one of the questions in the General Social Survey asks “Would
    you favor or oppose a law which would require a person to obtain a police permit
    before he or she could buy a gun?” The responses are in a column called `GUNLAW`;
    here are the values.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE28]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '[PRE29]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '`1` means yes and `2` means no, so most respondents are in favor.'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
- en: To explore the relationship between this variable and factors like age, sex,
    and education, we can use StatsModels, which provides a function that does logistic
    regression.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
- en: To use it, we have to recode the variable so `1` means “yes” and `0` means “no”.
    We can do that by replacing `2` with `0`.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Now we can run the regression. Instead of `ols()`, we use `logit()`, which is
    named for the logit function, which is related to logistic regression.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE31]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '[PRE32]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Estimating the parameters for the logistic model is an iterative process, so
    the output contains information about the number of iterations. Other than that,
    everything is the same as what we have seen before. And here are the results.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE33]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '[PRE34]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: The parameters are in the form of **log odds**, which you may or may not be
    familiar with. I won’t explain them in detail here, except to say that positive
    values are associated with things that make the outcome more likely, and negative
    values make the outcome less likely.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 参数以**对数几率**的形式给出，这可能是您熟悉的，也可能不是。我不会在这里详细解释它们，除了说正值与使结果更有可能的事物相关联，负值使结果更不可能。
- en: For example, the parameter associated with `SEX=2` is 0.75, which indicates
    that women are more likely to support this form of gun control. To see how much
    more likely, we can generate predictions, as we did with linear regression.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，与`SEX=2`相关的参数为0.75，这表明女性更有可能支持这种形式的枪支管制。为了了解更有可能的程度，我们可以生成预测，就像我们用线性回归一样。
- en: As an example, we’ll generate predictions for different ages and sexes, with
    education held constant. First we need a `DataFrame` with `AGE` and `EDUC`.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 举个例子，我们将为不同年龄和性别生成预测，教育水平保持不变。首先我们需要一个包含`AGE`和`EDUC`的`DataFrame`。
- en: '[PRE35]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: Then we can compute `AGE2` and `EDUC2`.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们可以计算`AGE2`和`EDUC2`。
- en: '[PRE36]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: We can generate predictions for men like this.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以这样为男性生成预测。
- en: '[PRE37]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: And for women like this.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 以及为女性生成预测。
- en: '[PRE38]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Now, to visualize the results, we’ll start by plotting the data. As we’ve done
    before, we’ll divide the respondents into age groups and compute the mean in each
    group. The mean of a binary variable is the fraction of people in favor.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，为了可视化结果，我们将从绘制数据开始。和以前一样，我们将调查对象分成年龄组，并计算每组的平均值。二元变量的平均值是支持的人的比例。
- en: Then we can plot the predictions, for men and women, as a function of age.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们可以绘制预测，男性和女性的预测作为年龄的函数。
- en: '[PRE39]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: '![_images/10_regression_89_0.png](../Images/7a178679eac22806f63ea7ef315d4f31.png)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![_images/10_regression_89_0.png](../Images/7a178679eac22806f63ea7ef315d4f31.png)'
- en: According to the model, people near age 50 are least likely to support gun control
    (at least as this question was posed). And women are more likely to support it
    than men, by almost 15 percentage points.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 根据模型，接近50岁的人最不可能支持枪支管制（至少是按照这个问题的提法）。女性比男性更有可能支持，差距近15个百分点。
- en: Logistic regression is a powerful tool for exploring relationships between a
    binary variable and the factors that predict it. In the exercises, you’ll explore
    the factors that predict support for legalizing marijuana.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 逻辑回归是一种探索二元变量和预测因素之间关系的强大工具。在练习中，您将探索预测支持大麻合法化的因素。
- en: '**Exercise:** Let’s use logistic regression to predict a binary variable. Specifically,
    we’ll use age, sex, and education level to predict support for legalizing marijuana
    in the U.S.'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: '**练习：**让我们使用逻辑回归来预测一个二元变量。具体来说，我们将使用年龄、性别和教育水平来预测美国对大麻合法化的支持。'
- en: In the GSS dataset, the variable `GRASS` records the answer to the question
    “Do you think the use of marijuana should be made legal or not?”
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 在GSS数据集中，变量`GRASS`记录了问题“您认为大麻的使用应该合法化吗？”的答案。
- en: First, use `replace` to recode the `GRASS` column so that `1` means yes and
    `0` means no. Use `value_counts` to check.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，使用`replace`重新编码`GRASS`列，使`1`表示是，`0`表示否。使用`value_counts`进行检查。
- en: Next, use `smf.logit()` to predict `GRASS` using the variables `AGE`, `AGE2`,
    `EDUC`, and `EDUC2`, along with `SEX` as a categorical variable. Display the parameters.
    Are men or women more likely to support legalization?
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，使用`smf.logit()`来使用变量`AGE`、`AGE2`、`EDUC`和`EDUC2`以及`SEX`作为分类变量来预测`GRASS`。显示参数。男性还是女性更有可能支持合法化？
- en: To generate predictions, start with an empty DataFrame. Add a column called
    `AGE` that contains a sequence of values from 18 to 89\. Add a column called `EDUC`
    and set it to 12 years. Then compute a column, `AGE2`, which is the square of
    `AGE`, and a column, `EDUC2`, which is the square of `EDUC`.
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要生成预测，从一个空的DataFrame开始。添加一个名为`AGE`的列，其中包含从18到89的值的序列。添加一个名为`EDUC`的列，并将其设置为12年。然后计算一个名为`AGE2`的列，它是`AGE`的平方，以及一个名为`EDUC2`的列，它是`EDUC`的平方。
- en: Use `predict` to generate predictions for men (`SEX=1`) and women (`SEX=2`).
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`predict`来为男性（`SEX=1`）和女性（`SEX=2`）生成预测。
- en: Generate a plot that shows (1) the average level of support for legalizing marijuana
    in each age group, (2) the level of support the model predicts for men as a function
    of age, and (3) the level of support predicted for women as a function of age.
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成一个图表，显示（1）每个年龄组对大麻合法化的平均支持水平，（2）模型对男性的预测支持水平作为年龄的函数，以及（3）模型对女性的预测支持水平作为年龄的函数。
- en: Summary
  id: totrans-182
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 总结
- en: At this point, I’d like to summarize the topics we’ve covered so far, and make
    some connections that might clarify the big picture.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，我想总结一下我们到目前为止所涵盖的主题，并进行一些可能澄清整体情况的联系。
- en: 'A central theme of this book is **exploratory data analysis**, which a process
    and set of tools for exploring a dataset, visualizing distributions, and discovering
    relationships between variables. The last four chapters demonstrate the steps
    of this process:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 本书的一个核心主题是**探索性数据分析**，这是一种探索数据集、可视化分布和发现变量之间关系的过程和工具集。最后四章展示了这个过程的步骤：
- en: Chapter 7 is about importing and cleaning data, and checking for errors and
    other special conditions. This might not be the most exciting part of the process,
    but time spent validating data can save you from embarrassing errors.
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第7章是关于导入和清理数据，检查错误和其他特殊情况。这可能不是过程中最令人兴奋的部分，但验证数据所花费的时间可以避免令人尴尬的错误。
- en: Chapter 8 is about exploring variables one at a time, visualizing distributions
    using PMFs, CDFs, and KDE, and choosing appropriate summary statistics.
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第8章是关于逐一探索变量，使用PMF、CDF和KDE可视化分布，并选择适当的摘要统计信息。
- en: In Chapter 9 we explored relationships between variables two at a time, using
    scatter plots and other visualizations; and we quantified those relationships
    using correlation and simple regression.
  id: totrans-187
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 第9章中，我们探讨了两两变量之间的关系，使用散点图和其他可视化工具，并使用相关性和简单回归来量化这些关系。
- en: Finally, in this chapter, we explored multivariate relationships using multiple
    regression and logistic regression.
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后，在这一章中，我们使用多元回归和逻辑回归探索了多变量关系。
- en: In Chapter 7, we looked at the distribution of birth weights from the National
    Survey of Family Growth. If you only remember one thing, remember the 99 pound
    babies, and how much it can affect your results if you don’t validate the data.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 在第7章，我们研究了来自国家家庭增长调查的出生体重分布。如果你只记住一件事，记住99磅的婴儿，以及如果你不验证数据会对结果产生多大影响。
- en: In Chapter 8 we looked at the distributions of age, income, and other variables
    from the General Social Survey. I recommended using CDFs as the best way to explore
    distributions. But when you present to audiences that are not familiar with CDFs,
    you can use PMFs if there are a small number of unique values, and KDE if there
    are a lot.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 在第8章，我们研究了来自综合社会调查的年龄、收入和其他变量的分布。我建议使用CDF作为探索分布的最佳方式。但当你向不熟悉CDF的观众展示时，如果唯一值较少，可以使用PMF，如果唯一值较多，可以使用KDE。
- en: In Chapter 9 we looked at heights and weights from the BRFSS, and developed
    several ways to visualize relationships between variables, including scatter plots,
    violin plots, and box plots.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 在第9章，我们研究了来自BRFSS的身高和体重，并开发了几种可视化变量之间关系的方法，包括散点图、小提琴图和箱线图。
- en: We used the coefficient of correlation to quantify the strength of a relationship.
    We also used simple regression to estimate slope, which is often what we care
    more about, not correlation.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用相关系数来量化关系的强度。我们还使用简单回归来估计斜率，这通常是我们更关心的，而不是相关性。
- en: But remember that both of these methods only capture linear relationships; if
    the relationship is non-linear, they can be misleading. Always look at a visualization,
    like a scatter plot, before computing correlation or simple regression.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 但请记住，这两种方法只能捕捉线性关系；如果关系是非线性的，它们可能会误导。在计算相关性或简单回归之前，始终查看可视化，比如散点图。
- en: In Chapter 10 we used multiple regression to add control variables and to describe
    non-linear relationships. And finally we used logistic regression to explain and
    predict binary variables.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 在第10章，我们使用多元回归来添加控制变量并描述非线性关系。最后，我们使用逻辑回归来解释和预测二元变量。
- en: We moved through a lot of material quickly, but if you practice and apply these
    methods to other questions and other datasets, you will learn more as you go.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 我们迅速地涉及了很多材料，但如果你练习并将这些方法应用到其他问题和其他数据集，你会在实践中学到更多。
- en: In the next chapter, we will move on to a new topic, resampling, which is a
    versatile tool for statistical inference.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将继续讨论一个新主题，重采样，这是统计推断的一种多功能工具。

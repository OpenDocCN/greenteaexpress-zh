# 第二十四章：左撇子姐妹问题

> 原文：[`allendowney.github.io/ThinkBayes2/sister.html`](https://allendowney.github.io/ThinkBayes2/sister.html)
> 
> 译者：[飞龙](https://github.com/wizardforcel)
> 
> 协议：[CC BY-NC-SA 4.0](http://creativecommons.org/licenses/by-nc-sa/4.0/)


假设你遇到了一个看起来像你朋友玛丽的兄弟的人。你问他是否有一个叫玛丽的姐妹，他说“是的，但我不认为我认识你。”

你记得玛丽有一个左撇子的姐妹，但你不记得她的名字。所以你问你的新朋友是否有另一个左撇子的姐妹。

如果他有，那提供了多少证据表明他是你朋友的兄弟，而不是偶然有一个叫玛丽的姐妹和另一个左撇子姐妹的随机人。换句话说，左撇子姐妹的贝叶斯因子是多少？

让我们假设：

+   在 100 个有孩子的家庭中，有 20 个有一个孩子，30 个有两个孩子，40 个有三个孩子，10 个有四个孩子。

+   所有的孩子都有相同的概率是男孩或女孩，十个女孩中有一个是左撇子，一百个女孩中有一个叫玛丽。

+   姓名、性别和惯用手是独立的，所以每个孩子成为女孩、左撇子或叫玛丽的概率都是相同的。

+   如果你遇到的人有超过一个叫玛丽的姐妹，他会说的，但他可能有超过一个左撇子的姐妹。

## 构建先验

我将制作一个 Pandas `Series`，列举可能有 2、3 或 4 个孩子的家庭。

```py
import pandas as pd

qs = [(2, 0),
      (1, 1),
      (0, 2),
      (3, 0),
      (2, 1),
      (1, 2),
      (0, 3),
      (4, 0),
      (3, 1),
      (2, 2),
      (1, 3),
      (0, 4),
    ]
index = pd.MultiIndex.from_tuples(qs, names=['Boys', 'Girls']) 
```

为了计算每种类型家庭的比例，我将使用 Scipy 来计算二项分布。

```py
from scipy.stats import binom

boys = index.to_frame()['Boys']
girls = index.to_frame()['Girls']
ps = binom.pmf(girls, boys+girls, 0.5) 
```

并将结果放入 Pandas `Series`中。

```py
prior1 = pd.Series(ps, index, name='Prior')
pd.DataFrame(prior1) 
```

|  |  | 先验 |
| --- | --- | --- |
| 男孩 | 女孩 |  |
| --- | --- | --- |
| 2 | 0 | 0.2500 |
| 1 | 1 | 0.5000 |
| 0 | 2 | 0.2500 |
| 3 | 0 | 0.1250 |
| 2 | 1 | 0.3750 |
| 1 | 2 | 0.3750 |
| 0 | 3 | 0.1250 |
| 4 | 0 | 0.0625 |
| 3 | 1 | 0.2500 |
| 2 | 2 | 0.3750 |
| 1 | 3 | 0.2500 |
| 0 | 4 | 0.0625 |

但我们还知道这些家庭的信息频率与 30％、40％和 10％成比例，所以我们可以进行乘法运算。

```py
ps = [30, 30, 30, 40, 40, 40, 40, 10, 10, 10, 10, 10]

prior1 *= ps
pd.DataFrame(prior1) 
```

|  |  | 先验 |
| --- | --- | --- |
| 男孩 | 女孩 |  |
| --- | --- | --- |
| 2 | 0 | 7.500 |
| 1 | 1 | 15.000 |
| 0 | 2 | 7.500 |
| 3 | 0 | 5.000 |
| 2 | 1 | 15.000 |
| 1 | 2 | 15.000 |
| 0 | 3 | 5.000 |
| 4 | 0 | 0.625 |
| 3 | 1 | 2.500 |
| 2 | 2 | 3.750 |
| 1 | 3 | 2.500 |
| 0 | 4 | 0.625 |

所以这是（未归一化的）先验。

我将使用以下函数进行贝叶斯更新。

```py
import pandas as pd

def make_table(prior, likelihood):
  """Make a DataFrame representing a Bayesian update."""
    table = pd.DataFrame(prior)
    table.columns = ['Prior']
    table['Likelihood'] = likelihood
    table['Product'] = (table['Prior'] * table['Likelihood'])
    total = table['Product'].sum()
    table['Posterior'] = table['Product'] / total
    return table 
```

这个函数接受一个先验和一个似然，并返回一个`DataFrame`

## 第一次更新

由于[长度偏差抽样](https://towardsdatascience.com/the-inspection-paradox-is-everywhere-2ef1c2e9d709)，你遇到的人更有可能来自男孩更多的家庭。具体来说，从一个有$n$个男孩的家庭中遇到某人的可能性与$n$成比例。

```py
likelihood1 = prior1.index.to_frame()['Boys']
table1 = make_table(prior1, likelihood1)
table1 
```

|  |  | 先验 | 似然 | 乘积 | 后验 |
| --- | --- | --- | --- | --- | --- |
| 男孩 | 女孩 |  |  |  |  |
| --- | --- | --- | --- | --- | --- |
| 2 | 0 | 7.500 | 2 | 15.0 | 0.136364 |
| 1 | 1 | 15.000 | 1 | 15.0 | 0.136364 |
| 0 | 2 | 7.500 | 0 | 0.0 | 0.000000 |
| 3 | 0 | 5.000 | 3 | 15.0 | 0.136364 |
| 2 | 1 | 15.000 | 2 | 30.0 | 0.272727 |
| 1 | 2 | 15.000 | 1 | 15.0 | 0.136364 |
| 0 | 3 | 5.000 | 0 | 0.0 | 0.000000 |
| 4 | 0 | 0.625 | 4 | 2.5 | 0.022727 |
| 3 | 1 | 2.500 | 3 | 7.5 | 0.068182 |
| 2 | 2 | 3.750 | 2 | 7.5 | 0.068182 |
| 1 | 3 | 2.500 | 1 | 2.5 | 0.022727 |
| 0 | 4 | 0.625 | 0 | 0.0 | 0.000000 |

这就是我们在第一次更新后对这个家庭应该相信的事情。

## 第二次更新

一个人恰好有一个叫玛丽的姐妹的可能性由二项分布给出，其中`n`是家庭中女孩的数量，`p`是一个女孩被命名为玛丽的概率。

```py
from scipy.stats import binom

ns = prior1.index.to_frame()['Girls']
p = 1 / 100
k = 1

likelihood2 = binom.pmf(k, ns, p)
likelihood2 
```

```py
array([0\.        , 0.01      , 0.0198    , 0\.        , 0.01      ,
       0.0198    , 0.029403  , 0\.        , 0.01      , 0.0198    ,
       0.029403  , 0.03881196]) 
```

这是第二次更新。

```py
prior2 = table1['Posterior']
table2 = make_table(prior2, likelihood2)
table2 
```

|  |  | 先验 | 似然 | 乘积 | 后验 |
| --- | --- | --- | --- | --- | --- |
| 男孩 | 女孩 |  |  |  |  |
| --- | --- | --- | --- | --- | --- |
| 2 | 0 | 0.136364 | 0.000000 | 0.000000 | 0.000000 |
| 1 | 1 | 0.136364 | 0.010000 | 0.001364 | 0.143677 |
| 0 | 2 | 0.000000 | 0.019800 | 0.000000 | 0.000000 |
| 3 | 0 | 0.136364 | 0.000000 | 0.000000 | 0.000000 |
| 2 | 1 | 0.272727 | 0.010000 | 0.002727 | 0.287354 |
| 1 | 2 | 0.136364 | 0.019800 | 0.002700 | 0.284481 |
| 0 | 3 | 0.000000 | 0.029403 | 0.000000 | 0.000000 |
| 4 | 0 | 0.022727 | 0.000000 | 0.000000 | 0.000000 |
| 3 | 1 | 0.068182 | 0.010000 | 0.000682 | 0.071839 |
| 2 | 2 | 0.068182 | 0.019800 | 0.001350 | 0.142240 |
| 1 | 3 | 0.022727 | 0.029403 | 0.000668 | 0.070409 |
| 0 | 4 | 0.000000 | 0.038812 | 0.000000 | 0.000000 |

根据名为玛丽的姐妹，我们可以排除没有女孩的家庭，而有多于一个女孩的家庭更有可能。

## 左撇子姐妹的概率

最后，我们可以计算他至少有一个左撇子姐妹的概率。似然性再次来自二项分布，其中`n`是*额外*姐妹的数量，我们使用生存函数来计算一个或多个姐妹是左撇子的概率。

```py
ns = prior1.index.to_frame()['Girls'] - 1
ns.name = 'Additional sisters'
neg = (ns < 0)
ns[neg] = 0
pd.DataFrame(ns) 
```

|  |  | 附加姐妹 |
| --- | --- | --- |
| 男孩 | 女孩 |  |
| --- | --- | --- |
| 2 | 0 | 0 |
| 1 | 1 | 0 |
| 0 | 2 | 1 |
| 3 | 0 | 0 |
| 2 | 1 | 0 |
| 1 | 2 | 1 |
| 0 | 3 | 2 |
| 4 | 0 | 0 |
| 3 | 1 | 0 |
| 2 | 2 | 1 |
| 1 | 3 | 2 |
| 0 | 4 | 3 |

```py
p = 1 / 10
k = 1

likelihood3 = binom.sf(k-1, ns, p)
likelihood3 
```

```py
array([0\.   , 0\.   , 0.1  , 0\.   , 0\.   , 0.1  , 0.19 , 0\.   , 0\.   ,
       0.1  , 0.19 , 0.271]) 
```

计算结果的一个方便的方法是假设发生了更新，忽略后验概率，然后计算产品的总和。

```py
prior3 = table2['Posterior']
table3 = make_table(prior3, likelihood3)
table3 
```

|  |  | 先验 | 似然性 | 产品 | 后验 |
| --- | --- | --- | --- | --- | --- |
| 男孩 | 女孩 |  |  |  |  |
| --- | --- | --- | --- | --- | --- |
| 2 | 0 | 0.000000 | 0.000 | 0.000000 | 0.000000 |
| 1 | 1 | 0.143677 | 0.000 | 0.000000 | 0.000000 |
| 0 | 2 | 0.000000 | 0.100 | 0.000000 | 0.000000 |
| 3 | 0 | 0.000000 | 0.000 | 0.000000 | 0.000000 |
| 2 | 1 | 0.287354 | 0.000 | 0.000000 | 0.000000 |
| 1 | 2 | 0.284481 | 0.100 | 0.028448 | 0.507550 |
| 0 | 3 | 0.000000 | 0.190 | 0.000000 | 0.000000 |
| 4 | 0 | 0.000000 | 0.000 | 0.000000 | 0.000000 |
| 3 | 1 | 0.071839 | 0.000 | 0.000000 | 0.000000 |
| 2 | 2 | 0.142240 | 0.100 | 0.014224 | 0.253775 |
| 1 | 3 | 0.070409 | 0.190 | 0.013378 | 0.238675 |
| 0 | 4 | 0.000000 | 0.271 | 0.000000 | 0.000000 |

此时，只剩下三种家庭类型，(1,2), (2,2), 和(1,3)。

这是你的新朋友有左撇子姐妹的总概率。

```py
p = table3['Product'].sum()
p 
```

```py
0.0560498128605398 
```

## 贝叶斯因子

如果你的对话者是你朋友的兄弟，那么他有左撇子姐妹的概率是 1。如果他不是你朋友的兄弟，概率是`p`。因此，贝叶斯因子是这些概率的比值。

```py
1/p 
```

```py
17.841272770850235 
```

这可能是我创作的最难的贝叶斯谜题。事实上，第一次我做错了，直到[Aubrey Clayton 说服我](https://twitter.com/aubreyclayton/status/1420041376377475075)我需要考虑每个家庭的男孩和女孩的数量，而不仅仅是家庭的大小。他通过在一个巨大的电子表格中列举可能的家庭来解决了这个问题！所以我们得到相同的答案让我更有信心它是正确的。

感谢 Aubrey 和 Twitter 上提交答案的其他人，包括[Corey Yanofsky](https://twitter.com/Corey_Yanofsky/status/1418627294256582664)和[Michal Haltuf](https://twitter.com/MichalHaltuf/status/1418685902717693952)。

如果你喜欢这个谜题，你可能会喜欢[《Think Bayes》的新第二版](https://thinkbayes.com)。
